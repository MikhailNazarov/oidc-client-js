!function webpackUniversalModuleDefinition(e,t){if("object"==typeof exports&&"object"==typeof module)module.exports=t();else if("function"==typeof define&&define.amd)define([],t);else{var n=t();for(var i in n)("object"==typeof exports?exports:e)[i]=n[i]}}(window,(function(){return function(e){var t={};function __webpack_require__(n){if(t[n])return t[n].exports;var i=t[n]={i:n,l:!1,exports:{}};return e[n].call(i.exports,i,i.exports,__webpack_require__),i.l=!0,i.exports}return __webpack_require__.m=e,__webpack_require__.c=t,__webpack_require__.d=function(e,t,n){__webpack_require__.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},__webpack_require__.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},__webpack_require__.t=function(e,t){if(1&t&&(e=__webpack_require__(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(__webpack_require__.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)__webpack_require__.d(n,i,function(t){return e[t]}.bind(null,i));return n},__webpack_require__.n=function(e){var t=e&&e.__esModule?function getDefault(){return e.default}:function getModuleExports(){return e};return __webpack_require__.d(t,"a",t),t},__webpack_require__.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},__webpack_require__.p="",__webpack_require__(__webpack_require__.s=7)}([function(e,t,n){var i;e.exports=(i=n(4),function(e){var t=i,n=t.lib,o=n.WordArray,s=n.Hasher,a=t.algo,u=[],c=[];!function(){function isPrime(t){for(var n=e.sqrt(t),i=2;i<=n;i++)if(!(t%i))return!1;return!0}function getFractionalBits(e){return 4294967296*(e-(0|e))|0}for(var t=2,n=0;n<64;)isPrime(t)&&(n<8&&(u[n]=getFractionalBits(e.pow(t,.5))),c[n]=getFractionalBits(e.pow(t,1/3)),n++),t++}();var d=[],p=a.SHA256=s.extend({_doReset:function(){this._hash=new o.init(u.slice(0))},_doProcessBlock:function(e,t){for(var n=this._hash.words,i=n[0],o=n[1],s=n[2],a=n[3],u=n[4],p=n[5],l=n[6],g=n[7],h=0;h<64;h++){if(h<16)d[h]=0|e[t+h];else{var f=d[h-15],_=(f<<25|f>>>7)^(f<<14|f>>>18)^f>>>3,v=d[h-2],m=(v<<15|v>>>17)^(v<<13|v>>>19)^v>>>10;d[h]=_+d[h-7]+m+d[h-16]}var y=i&o^i&s^o&s,b=(i<<30|i>>>2)^(i<<19|i>>>13)^(i<<10|i>>>22),S=g+((u<<26|u>>>6)^(u<<21|u>>>11)^(u<<7|u>>>25))+(u&p^~u&l)+c[h]+d[h];g=l,l=p,p=u,u=a+S|0,a=s,s=o,o=i,i=S+(b+y)|0}n[0]=n[0]+i|0,n[1]=n[1]+o|0,n[2]=n[2]+s|0,n[3]=n[3]+a|0,n[4]=n[4]+u|0,n[5]=n[5]+p|0,n[6]=n[6]+l|0,n[7]=n[7]+g|0},_doFinalize:function(){var t=this._data,n=t.words,i=8*this._nDataBytes,o=8*t.sigBytes;return n[o>>>5]|=128<<24-o%32,n[14+(o+64>>>9<<4)]=e.floor(i/4294967296),n[15+(o+64>>>9<<4)]=i,t.sigBytes=4*n.length,this._process(),this._hash},clone:function(){var e=s.clone.call(this);return e._hash=this._hash.clone(),e}});t.SHA256=s._createHelper(p),t.HmacSHA256=s._createHmacHelper(p)}(Math),i.SHA256)},function(e,t,n){(function(){var t;function BigInteger(e,t,n){null!=e&&("number"==typeof e?this.fromNumber(e,t,n):null==t&&"string"!=typeof e?this.fromString(e,256):this.fromString(e,t))}function nbi(){return new BigInteger(null)}var n="undefined"!=typeof navigator;n&&"Microsoft Internet Explorer"==navigator.appName?(BigInteger.prototype.am=function am2(e,t,n,i,o,s){for(var a=32767&t,u=t>>15;--s>=0;){var c=32767&this[e],d=this[e++]>>15,p=u*c+d*a;o=((c=a*c+((32767&p)<<15)+n[i]+(1073741823&o))>>>30)+(p>>>15)+u*d+(o>>>30),n[i++]=1073741823&c}return o},t=30):n&&"Netscape"!=navigator.appName?(BigInteger.prototype.am=function am1(e,t,n,i,o,s){for(;--s>=0;){var a=t*this[e++]+n[i]+o;o=Math.floor(a/67108864),n[i++]=67108863&a}return o},t=26):(BigInteger.prototype.am=function am3(e,t,n,i,o,s){for(var a=16383&t,u=t>>14;--s>=0;){var c=16383&this[e],d=this[e++]>>14,p=u*c+d*a;o=((c=a*c+((16383&p)<<14)+n[i]+o)>>28)+(p>>14)+u*d,n[i++]=268435455&c}return o},t=28),BigInteger.prototype.DB=t,BigInteger.prototype.DM=(1<<t)-1,BigInteger.prototype.DV=1<<t;BigInteger.prototype.FV=Math.pow(2,52),BigInteger.prototype.F1=52-t,BigInteger.prototype.F2=2*t-52;var i,o,s=new Array;for(i="0".charCodeAt(0),o=0;o<=9;++o)s[i++]=o;for(i="a".charCodeAt(0),o=10;o<36;++o)s[i++]=o;for(i="A".charCodeAt(0),o=10;o<36;++o)s[i++]=o;function int2char(e){return"0123456789abcdefghijklmnopqrstuvwxyz".charAt(e)}function intAt(e,t){var n=s[e.charCodeAt(t)];return null==n?-1:n}function nbv(e){var t=nbi();return t.fromInt(e),t}function nbits(e){var t,n=1;return 0!=(t=e>>>16)&&(e=t,n+=16),0!=(t=e>>8)&&(e=t,n+=8),0!=(t=e>>4)&&(e=t,n+=4),0!=(t=e>>2)&&(e=t,n+=2),0!=(t=e>>1)&&(e=t,n+=1),n}function Classic(e){this.m=e}function Montgomery(e){this.m=e,this.mp=e.invDigit(),this.mpl=32767&this.mp,this.mph=this.mp>>15,this.um=(1<<e.DB-15)-1,this.mt2=2*e.t}function op_and(e,t){return e&t}function op_or(e,t){return e|t}function op_xor(e,t){return e^t}function op_andnot(e,t){return e&~t}function lbit(e){if(0==e)return-1;var t=0;return 0==(65535&e)&&(e>>=16,t+=16),0==(255&e)&&(e>>=8,t+=8),0==(15&e)&&(e>>=4,t+=4),0==(3&e)&&(e>>=2,t+=2),0==(1&e)&&++t,t}function cbit(e){for(var t=0;0!=e;)e&=e-1,++t;return t}function NullExp(){}function nNop(e){return e}function Barrett(e){this.r2=nbi(),this.q3=nbi(),BigInteger.ONE.dlShiftTo(2*e.t,this.r2),this.mu=this.r2.divide(e),this.m=e}Classic.prototype.convert=function cConvert(e){return e.s<0||e.compareTo(this.m)>=0?e.mod(this.m):e},Classic.prototype.revert=function cRevert(e){return e},Classic.prototype.reduce=function cReduce(e){e.divRemTo(this.m,null,e)},Classic.prototype.mulTo=function cMulTo(e,t,n){e.multiplyTo(t,n),this.reduce(n)},Classic.prototype.sqrTo=function cSqrTo(e,t){e.squareTo(t),this.reduce(t)},Montgomery.prototype.convert=function montConvert(e){var t=nbi();return e.abs().dlShiftTo(this.m.t,t),t.divRemTo(this.m,null,t),e.s<0&&t.compareTo(BigInteger.ZERO)>0&&this.m.subTo(t,t),t},Montgomery.prototype.revert=function montRevert(e){var t=nbi();return e.copyTo(t),this.reduce(t),t},Montgomery.prototype.reduce=function montReduce(e){for(;e.t<=this.mt2;)e[e.t++]=0;for(var t=0;t<this.m.t;++t){var n=32767&e[t],i=n*this.mpl+((n*this.mph+(e[t]>>15)*this.mpl&this.um)<<15)&e.DM;for(e[n=t+this.m.t]+=this.m.am(0,i,e,t,0,this.m.t);e[n]>=e.DV;)e[n]-=e.DV,e[++n]++}e.clamp(),e.drShiftTo(this.m.t,e),e.compareTo(this.m)>=0&&e.subTo(this.m,e)},Montgomery.prototype.mulTo=function montMulTo(e,t,n){e.multiplyTo(t,n),this.reduce(n)},Montgomery.prototype.sqrTo=function montSqrTo(e,t){e.squareTo(t),this.reduce(t)},BigInteger.prototype.copyTo=function bnpCopyTo(e){for(var t=this.t-1;t>=0;--t)e[t]=this[t];e.t=this.t,e.s=this.s},BigInteger.prototype.fromInt=function bnpFromInt(e){this.t=1,this.s=e<0?-1:0,e>0?this[0]=e:e<-1?this[0]=e+this.DV:this.t=0},BigInteger.prototype.fromString=function bnpFromString(e,t){var n;if(16==t)n=4;else if(8==t)n=3;else if(256==t)n=8;else if(2==t)n=1;else if(32==t)n=5;else{if(4!=t)return void this.fromRadix(e,t);n=2}this.t=0,this.s=0;for(var i=e.length,o=!1,s=0;--i>=0;){var a=8==n?255&e[i]:intAt(e,i);a<0?"-"==e.charAt(i)&&(o=!0):(o=!1,0==s?this[this.t++]=a:s+n>this.DB?(this[this.t-1]|=(a&(1<<this.DB-s)-1)<<s,this[this.t++]=a>>this.DB-s):this[this.t-1]|=a<<s,(s+=n)>=this.DB&&(s-=this.DB))}8==n&&0!=(128&e[0])&&(this.s=-1,s>0&&(this[this.t-1]|=(1<<this.DB-s)-1<<s)),this.clamp(),o&&BigInteger.ZERO.subTo(this,this)},BigInteger.prototype.clamp=function bnpClamp(){for(var e=this.s&this.DM;this.t>0&&this[this.t-1]==e;)--this.t},BigInteger.prototype.dlShiftTo=function bnpDLShiftTo(e,t){var n;for(n=this.t-1;n>=0;--n)t[n+e]=this[n];for(n=e-1;n>=0;--n)t[n]=0;t.t=this.t+e,t.s=this.s},BigInteger.prototype.drShiftTo=function bnpDRShiftTo(e,t){for(var n=e;n<this.t;++n)t[n-e]=this[n];t.t=Math.max(this.t-e,0),t.s=this.s},BigInteger.prototype.lShiftTo=function bnpLShiftTo(e,t){var n,i=e%this.DB,o=this.DB-i,s=(1<<o)-1,a=Math.floor(e/this.DB),u=this.s<<i&this.DM;for(n=this.t-1;n>=0;--n)t[n+a+1]=this[n]>>o|u,u=(this[n]&s)<<i;for(n=a-1;n>=0;--n)t[n]=0;t[a]=u,t.t=this.t+a+1,t.s=this.s,t.clamp()},BigInteger.prototype.rShiftTo=function bnpRShiftTo(e,t){t.s=this.s;var n=Math.floor(e/this.DB);if(n>=this.t)t.t=0;else{var i=e%this.DB,o=this.DB-i,s=(1<<i)-1;t[0]=this[n]>>i;for(var a=n+1;a<this.t;++a)t[a-n-1]|=(this[a]&s)<<o,t[a-n]=this[a]>>i;i>0&&(t[this.t-n-1]|=(this.s&s)<<o),t.t=this.t-n,t.clamp()}},BigInteger.prototype.subTo=function bnpSubTo(e,t){for(var n=0,i=0,o=Math.min(e.t,this.t);n<o;)i+=this[n]-e[n],t[n++]=i&this.DM,i>>=this.DB;if(e.t<this.t){for(i-=e.s;n<this.t;)i+=this[n],t[n++]=i&this.DM,i>>=this.DB;i+=this.s}else{for(i+=this.s;n<e.t;)i-=e[n],t[n++]=i&this.DM,i>>=this.DB;i-=e.s}t.s=i<0?-1:0,i<-1?t[n++]=this.DV+i:i>0&&(t[n++]=i),t.t=n,t.clamp()},BigInteger.prototype.multiplyTo=function bnpMultiplyTo(e,t){var n=this.abs(),i=e.abs(),o=n.t;for(t.t=o+i.t;--o>=0;)t[o]=0;for(o=0;o<i.t;++o)t[o+n.t]=n.am(0,i[o],t,o,0,n.t);t.s=0,t.clamp(),this.s!=e.s&&BigInteger.ZERO.subTo(t,t)},BigInteger.prototype.squareTo=function bnpSquareTo(e){for(var t=this.abs(),n=e.t=2*t.t;--n>=0;)e[n]=0;for(n=0;n<t.t-1;++n){var i=t.am(n,t[n],e,2*n,0,1);(e[n+t.t]+=t.am(n+1,2*t[n],e,2*n+1,i,t.t-n-1))>=t.DV&&(e[n+t.t]-=t.DV,e[n+t.t+1]=1)}e.t>0&&(e[e.t-1]+=t.am(n,t[n],e,2*n,0,1)),e.s=0,e.clamp()},BigInteger.prototype.divRemTo=function bnpDivRemTo(e,t,n){var i=e.abs();if(!(i.t<=0)){var o=this.abs();if(o.t<i.t)return null!=t&&t.fromInt(0),void(null!=n&&this.copyTo(n));null==n&&(n=nbi());var s=nbi(),a=this.s,u=e.s,c=this.DB-nbits(i[i.t-1]);c>0?(i.lShiftTo(c,s),o.lShiftTo(c,n)):(i.copyTo(s),o.copyTo(n));var d=s.t,p=s[d-1];if(0!=p){var l=p*(1<<this.F1)+(d>1?s[d-2]>>this.F2:0),g=this.FV/l,h=(1<<this.F1)/l,f=1<<this.F2,_=n.t,v=_-d,m=null==t?nbi():t;for(s.dlShiftTo(v,m),n.compareTo(m)>=0&&(n[n.t++]=1,n.subTo(m,n)),BigInteger.ONE.dlShiftTo(d,m),m.subTo(s,s);s.t<d;)s[s.t++]=0;for(;--v>=0;){var y=n[--_]==p?this.DM:Math.floor(n[_]*g+(n[_-1]+f)*h);if((n[_]+=s.am(0,y,n,v,0,d))<y)for(s.dlShiftTo(v,m),n.subTo(m,n);n[_]<--y;)n.subTo(m,n)}null!=t&&(n.drShiftTo(d,t),a!=u&&BigInteger.ZERO.subTo(t,t)),n.t=d,n.clamp(),c>0&&n.rShiftTo(c,n),a<0&&BigInteger.ZERO.subTo(n,n)}}},BigInteger.prototype.invDigit=function bnpInvDigit(){if(this.t<1)return 0;var e=this[0];if(0==(1&e))return 0;var t=3&e;return(t=(t=(t=(t=t*(2-(15&e)*t)&15)*(2-(255&e)*t)&255)*(2-((65535&e)*t&65535))&65535)*(2-e*t%this.DV)%this.DV)>0?this.DV-t:-t},BigInteger.prototype.isEven=function bnpIsEven(){return 0==(this.t>0?1&this[0]:this.s)},BigInteger.prototype.exp=function bnpExp(e,t){if(e>4294967295||e<1)return BigInteger.ONE;var n=nbi(),i=nbi(),o=t.convert(this),s=nbits(e)-1;for(o.copyTo(n);--s>=0;)if(t.sqrTo(n,i),(e&1<<s)>0)t.mulTo(i,o,n);else{var a=n;n=i,i=a}return t.revert(n)},BigInteger.prototype.toString=function bnToString(e){if(this.s<0)return"-"+this.negate().toString(e);var t;if(16==e)t=4;else if(8==e)t=3;else if(2==e)t=1;else if(32==e)t=5;else{if(4!=e)return this.toRadix(e);t=2}var n,i=(1<<t)-1,o=!1,s="",a=this.t,u=this.DB-a*this.DB%t;if(a-- >0)for(u<this.DB&&(n=this[a]>>u)>0&&(o=!0,s=int2char(n));a>=0;)u<t?(n=(this[a]&(1<<u)-1)<<t-u,n|=this[--a]>>(u+=this.DB-t)):(n=this[a]>>(u-=t)&i,u<=0&&(u+=this.DB,--a)),n>0&&(o=!0),o&&(s+=int2char(n));return o?s:"0"},BigInteger.prototype.negate=function bnNegate(){var e=nbi();return BigInteger.ZERO.subTo(this,e),e},BigInteger.prototype.abs=function bnAbs(){return this.s<0?this.negate():this},BigInteger.prototype.compareTo=function bnCompareTo(e){var t=this.s-e.s;if(0!=t)return t;var n=this.t;if(0!=(t=n-e.t))return this.s<0?-t:t;for(;--n>=0;)if(0!=(t=this[n]-e[n]))return t;return 0},BigInteger.prototype.bitLength=function bnBitLength(){return this.t<=0?0:this.DB*(this.t-1)+nbits(this[this.t-1]^this.s&this.DM)},BigInteger.prototype.mod=function bnMod(e){var t=nbi();return this.abs().divRemTo(e,null,t),this.s<0&&t.compareTo(BigInteger.ZERO)>0&&e.subTo(t,t),t},BigInteger.prototype.modPowInt=function bnModPowInt(e,t){var n;return n=e<256||t.isEven()?new Classic(t):new Montgomery(t),this.exp(e,n)},BigInteger.ZERO=nbv(0),BigInteger.ONE=nbv(1),NullExp.prototype.convert=nNop,NullExp.prototype.revert=nNop,NullExp.prototype.mulTo=function nMulTo(e,t,n){e.multiplyTo(t,n)},NullExp.prototype.sqrTo=function nSqrTo(e,t){e.squareTo(t)},Barrett.prototype.convert=function barrettConvert(e){if(e.s<0||e.t>2*this.m.t)return e.mod(this.m);if(e.compareTo(this.m)<0)return e;var t=nbi();return e.copyTo(t),this.reduce(t),t},Barrett.prototype.revert=function barrettRevert(e){return e},Barrett.prototype.reduce=function barrettReduce(e){for(e.drShiftTo(this.m.t-1,this.r2),e.t>this.m.t+1&&(e.t=this.m.t+1,e.clamp()),this.mu.multiplyUpperTo(this.r2,this.m.t+1,this.q3),this.m.multiplyLowerTo(this.q3,this.m.t+1,this.r2);e.compareTo(this.r2)<0;)e.dAddOffset(1,this.m.t+1);for(e.subTo(this.r2,e);e.compareTo(this.m)>=0;)e.subTo(this.m,e)},Barrett.prototype.mulTo=function barrettMulTo(e,t,n){e.multiplyTo(t,n),this.reduce(n)},Barrett.prototype.sqrTo=function barrettSqrTo(e,t){e.squareTo(t),this.reduce(t)};var a,u,c,d=[2,3,5,7,11,13,17,19,23,29,31,37,41,43,47,53,59,61,67,71,73,79,83,89,97,101,103,107,109,113,127,131,137,139,149,151,157,163,167,173,179,181,191,193,197,199,211,223,227,229,233,239,241,251,257,263,269,271,277,281,283,293,307,311,313,317,331,337,347,349,353,359,367,373,379,383,389,397,401,409,419,421,431,433,439,443,449,457,461,463,467,479,487,491,499,503,509,521,523,541,547,557,563,569,571,577,587,593,599,601,607,613,617,619,631,641,643,647,653,659,661,673,677,683,691,701,709,719,727,733,739,743,751,757,761,769,773,787,797,809,811,821,823,827,829,839,853,857,859,863,877,881,883,887,907,911,919,929,937,941,947,953,967,971,977,983,991,997],p=(1<<26)/d[d.length-1];function rng_seed_time(){!function rng_seed_int(e){u[c++]^=255&e,u[c++]^=e>>8&255,u[c++]^=e>>16&255,u[c++]^=e>>24&255,c>=f&&(c-=f)}((new Date).getTime())}if(BigInteger.prototype.chunkSize=function bnpChunkSize(e){return Math.floor(Math.LN2*this.DB/Math.log(e))},BigInteger.prototype.toRadix=function bnpToRadix(e){if(null==e&&(e=10),0==this.signum()||e<2||e>36)return"0";var t=this.chunkSize(e),n=Math.pow(e,t),i=nbv(n),o=nbi(),s=nbi(),a="";for(this.divRemTo(i,o,s);o.signum()>0;)a=(n+s.intValue()).toString(e).substr(1)+a,o.divRemTo(i,o,s);return s.intValue().toString(e)+a},BigInteger.prototype.fromRadix=function bnpFromRadix(e,t){this.fromInt(0),null==t&&(t=10);for(var n=this.chunkSize(t),i=Math.pow(t,n),o=!1,s=0,a=0,u=0;u<e.length;++u){var c=intAt(e,u);c<0?"-"==e.charAt(u)&&0==this.signum()&&(o=!0):(a=t*a+c,++s>=n&&(this.dMultiply(i),this.dAddOffset(a,0),s=0,a=0))}s>0&&(this.dMultiply(Math.pow(t,s)),this.dAddOffset(a,0)),o&&BigInteger.ZERO.subTo(this,this)},BigInteger.prototype.fromNumber=function bnpFromNumber(e,t,n){if("number"==typeof t)if(e<2)this.fromInt(1);else for(this.fromNumber(e,n),this.testBit(e-1)||this.bitwiseTo(BigInteger.ONE.shiftLeft(e-1),op_or,this),this.isEven()&&this.dAddOffset(1,0);!this.isProbablePrime(t);)this.dAddOffset(2,0),this.bitLength()>e&&this.subTo(BigInteger.ONE.shiftLeft(e-1),this);else{var i=new Array,o=7&e;i.length=1+(e>>3),t.nextBytes(i),o>0?i[0]&=(1<<o)-1:i[0]=0,this.fromString(i,256)}},BigInteger.prototype.bitwiseTo=function bnpBitwiseTo(e,t,n){var i,o,s=Math.min(e.t,this.t);for(i=0;i<s;++i)n[i]=t(this[i],e[i]);if(e.t<this.t){for(o=e.s&this.DM,i=s;i<this.t;++i)n[i]=t(this[i],o);n.t=this.t}else{for(o=this.s&this.DM,i=s;i<e.t;++i)n[i]=t(o,e[i]);n.t=e.t}n.s=t(this.s,e.s),n.clamp()},BigInteger.prototype.changeBit=function bnpChangeBit(e,t){var n=BigInteger.ONE.shiftLeft(e);return this.bitwiseTo(n,t,n),n},BigInteger.prototype.addTo=function bnpAddTo(e,t){for(var n=0,i=0,o=Math.min(e.t,this.t);n<o;)i+=this[n]+e[n],t[n++]=i&this.DM,i>>=this.DB;if(e.t<this.t){for(i+=e.s;n<this.t;)i+=this[n],t[n++]=i&this.DM,i>>=this.DB;i+=this.s}else{for(i+=this.s;n<e.t;)i+=e[n],t[n++]=i&this.DM,i>>=this.DB;i+=e.s}t.s=i<0?-1:0,i>0?t[n++]=i:i<-1&&(t[n++]=this.DV+i),t.t=n,t.clamp()},BigInteger.prototype.dMultiply=function bnpDMultiply(e){this[this.t]=this.am(0,e-1,this,0,0,this.t),++this.t,this.clamp()},BigInteger.prototype.dAddOffset=function bnpDAddOffset(e,t){if(0!=e){for(;this.t<=t;)this[this.t++]=0;for(this[t]+=e;this[t]>=this.DV;)this[t]-=this.DV,++t>=this.t&&(this[this.t++]=0),++this[t]}},BigInteger.prototype.multiplyLowerTo=function bnpMultiplyLowerTo(e,t,n){var i,o=Math.min(this.t+e.t,t);for(n.s=0,n.t=o;o>0;)n[--o]=0;for(i=n.t-this.t;o<i;++o)n[o+this.t]=this.am(0,e[o],n,o,0,this.t);for(i=Math.min(e.t,t);o<i;++o)this.am(0,e[o],n,o,0,t-o);n.clamp()},BigInteger.prototype.multiplyUpperTo=function bnpMultiplyUpperTo(e,t,n){--t;var i=n.t=this.t+e.t-t;for(n.s=0;--i>=0;)n[i]=0;for(i=Math.max(t-this.t,0);i<e.t;++i)n[this.t+i-t]=this.am(t-i,e[i],n,0,0,this.t+i-t);n.clamp(),n.drShiftTo(1,n)},BigInteger.prototype.modInt=function bnpModInt(e){if(e<=0)return 0;var t=this.DV%e,n=this.s<0?e-1:0;if(this.t>0)if(0==t)n=this[0]%e;else for(var i=this.t-1;i>=0;--i)n=(t*n+this[i])%e;return n},BigInteger.prototype.millerRabin=function bnpMillerRabin(e){var t=this.subtract(BigInteger.ONE),n=t.getLowestSetBit();if(n<=0)return!1;var i=t.shiftRight(n);(e=e+1>>1)>d.length&&(e=d.length);for(var o=nbi(),s=0;s<e;++s){o.fromInt(d[Math.floor(Math.random()*d.length)]);var a=o.modPow(i,this);if(0!=a.compareTo(BigInteger.ONE)&&0!=a.compareTo(t)){for(var u=1;u++<n&&0!=a.compareTo(t);)if(0==(a=a.modPowInt(2,this)).compareTo(BigInteger.ONE))return!1;if(0!=a.compareTo(t))return!1}}return!0},BigInteger.prototype.clone=function bnClone(){var e=nbi();return this.copyTo(e),e},BigInteger.prototype.intValue=function bnIntValue(){if(this.s<0){if(1==this.t)return this[0]-this.DV;if(0==this.t)return-1}else{if(1==this.t)return this[0];if(0==this.t)return 0}return(this[1]&(1<<32-this.DB)-1)<<this.DB|this[0]},BigInteger.prototype.byteValue=function bnByteValue(){return 0==this.t?this.s:this[0]<<24>>24},BigInteger.prototype.shortValue=function bnShortValue(){return 0==this.t?this.s:this[0]<<16>>16},BigInteger.prototype.signum=function bnSigNum(){return this.s<0?-1:this.t<=0||1==this.t&&this[0]<=0?0:1},BigInteger.prototype.toByteArray=function bnToByteArray(){var e=this.t,t=new Array;t[0]=this.s;var n,i=this.DB-e*this.DB%8,o=0;if(e-- >0)for(i<this.DB&&(n=this[e]>>i)!=(this.s&this.DM)>>i&&(t[o++]=n|this.s<<this.DB-i);e>=0;)i<8?(n=(this[e]&(1<<i)-1)<<8-i,n|=this[--e]>>(i+=this.DB-8)):(n=this[e]>>(i-=8)&255,i<=0&&(i+=this.DB,--e)),0!=(128&n)&&(n|=-256),0==o&&(128&this.s)!=(128&n)&&++o,(o>0||n!=this.s)&&(t[o++]=n);return t},BigInteger.prototype.equals=function bnEquals(e){return 0==this.compareTo(e)},BigInteger.prototype.min=function bnMin(e){return this.compareTo(e)<0?this:e},BigInteger.prototype.max=function bnMax(e){return this.compareTo(e)>0?this:e},BigInteger.prototype.and=function bnAnd(e){var t=nbi();return this.bitwiseTo(e,op_and,t),t},BigInteger.prototype.or=function bnOr(e){var t=nbi();return this.bitwiseTo(e,op_or,t),t},BigInteger.prototype.xor=function bnXor(e){var t=nbi();return this.bitwiseTo(e,op_xor,t),t},BigInteger.prototype.andNot=function bnAndNot(e){var t=nbi();return this.bitwiseTo(e,op_andnot,t),t},BigInteger.prototype.not=function bnNot(){for(var e=nbi(),t=0;t<this.t;++t)e[t]=this.DM&~this[t];return e.t=this.t,e.s=~this.s,e},BigInteger.prototype.shiftLeft=function bnShiftLeft(e){var t=nbi();return e<0?this.rShiftTo(-e,t):this.lShiftTo(e,t),t},BigInteger.prototype.shiftRight=function bnShiftRight(e){var t=nbi();return e<0?this.lShiftTo(-e,t):this.rShiftTo(e,t),t},BigInteger.prototype.getLowestSetBit=function bnGetLowestSetBit(){for(var e=0;e<this.t;++e)if(0!=this[e])return e*this.DB+lbit(this[e]);return this.s<0?this.t*this.DB:-1},BigInteger.prototype.bitCount=function bnBitCount(){for(var e=0,t=this.s&this.DM,n=0;n<this.t;++n)e+=cbit(this[n]^t);return e},BigInteger.prototype.testBit=function bnTestBit(e){var t=Math.floor(e/this.DB);return t>=this.t?0!=this.s:0!=(this[t]&1<<e%this.DB)},BigInteger.prototype.setBit=function bnSetBit(e){return this.changeBit(e,op_or)},BigInteger.prototype.clearBit=function bnClearBit(e){return this.changeBit(e,op_andnot)},BigInteger.prototype.flipBit=function bnFlipBit(e){return this.changeBit(e,op_xor)},BigInteger.prototype.add=function bnAdd(e){var t=nbi();return this.addTo(e,t),t},BigInteger.prototype.subtract=function bnSubtract(e){var t=nbi();return this.subTo(e,t),t},BigInteger.prototype.multiply=function bnMultiply(e){var t=nbi();return this.multiplyTo(e,t),t},BigInteger.prototype.divide=function bnDivide(e){var t=nbi();return this.divRemTo(e,t,null),t},BigInteger.prototype.remainder=function bnRemainder(e){var t=nbi();return this.divRemTo(e,null,t),t},BigInteger.prototype.divideAndRemainder=function bnDivideAndRemainder(e){var t=nbi(),n=nbi();return this.divRemTo(e,t,n),new Array(t,n)},BigInteger.prototype.modPow=function bnModPow(e,t){var n,i,o=e.bitLength(),s=nbv(1);if(o<=0)return s;n=o<18?1:o<48?3:o<144?4:o<768?5:6,i=o<8?new Classic(t):t.isEven()?new Barrett(t):new Montgomery(t);var a=new Array,u=3,c=n-1,d=(1<<n)-1;if(a[1]=i.convert(this),n>1){var p=nbi();for(i.sqrTo(a[1],p);u<=d;)a[u]=nbi(),i.mulTo(p,a[u-2],a[u]),u+=2}var l,g,h=e.t-1,f=!0,_=nbi();for(o=nbits(e[h])-1;h>=0;){for(o>=c?l=e[h]>>o-c&d:(l=(e[h]&(1<<o+1)-1)<<c-o,h>0&&(l|=e[h-1]>>this.DB+o-c)),u=n;0==(1&l);)l>>=1,--u;if((o-=u)<0&&(o+=this.DB,--h),f)a[l].copyTo(s),f=!1;else{for(;u>1;)i.sqrTo(s,_),i.sqrTo(_,s),u-=2;u>0?i.sqrTo(s,_):(g=s,s=_,_=g),i.mulTo(_,a[l],s)}for(;h>=0&&0==(e[h]&1<<o);)i.sqrTo(s,_),g=s,s=_,_=g,--o<0&&(o=this.DB-1,--h)}return i.revert(s)},BigInteger.prototype.modInverse=function bnModInverse(e){var t=e.isEven();if(this.isEven()&&t||0==e.signum())return BigInteger.ZERO;for(var n=e.clone(),i=this.clone(),o=nbv(1),s=nbv(0),a=nbv(0),u=nbv(1);0!=n.signum();){for(;n.isEven();)n.rShiftTo(1,n),t?(o.isEven()&&s.isEven()||(o.addTo(this,o),s.subTo(e,s)),o.rShiftTo(1,o)):s.isEven()||s.subTo(e,s),s.rShiftTo(1,s);for(;i.isEven();)i.rShiftTo(1,i),t?(a.isEven()&&u.isEven()||(a.addTo(this,a),u.subTo(e,u)),a.rShiftTo(1,a)):u.isEven()||u.subTo(e,u),u.rShiftTo(1,u);n.compareTo(i)>=0?(n.subTo(i,n),t&&o.subTo(a,o),s.subTo(u,s)):(i.subTo(n,i),t&&a.subTo(o,a),u.subTo(s,u))}return 0!=i.compareTo(BigInteger.ONE)?BigInteger.ZERO:u.compareTo(e)>=0?u.subtract(e):u.signum()<0?(u.addTo(e,u),u.signum()<0?u.add(e):u):u},BigInteger.prototype.pow=function bnPow(e){return this.exp(e,new NullExp)},BigInteger.prototype.gcd=function bnGCD(e){var t=this.s<0?this.negate():this.clone(),n=e.s<0?e.negate():e.clone();if(t.compareTo(n)<0){var i=t;t=n,n=i}var o=t.getLowestSetBit(),s=n.getLowestSetBit();if(s<0)return t;for(o<s&&(s=o),s>0&&(t.rShiftTo(s,t),n.rShiftTo(s,n));t.signum()>0;)(o=t.getLowestSetBit())>0&&t.rShiftTo(o,t),(o=n.getLowestSetBit())>0&&n.rShiftTo(o,n),t.compareTo(n)>=0?(t.subTo(n,t),t.rShiftTo(1,t)):(n.subTo(t,n),n.rShiftTo(1,n));return s>0&&n.lShiftTo(s,n),n},BigInteger.prototype.isProbablePrime=function bnIsProbablePrime(e){var t,n=this.abs();if(1==n.t&&n[0]<=d[d.length-1]){for(t=0;t<d.length;++t)if(n[0]==d[t])return!0;return!1}if(n.isEven())return!1;for(t=1;t<d.length;){for(var i=d[t],o=t+1;o<d.length&&i<p;)i*=d[o++];for(i=n.modInt(i);t<o;)if(i%d[t++]==0)return!1}return n.millerRabin(e)},BigInteger.prototype.square=function bnSquare(){var e=nbi();return this.squareTo(e),e},BigInteger.prototype.Barrett=Barrett,null==u){var l;if(u=new Array,c=0,"undefined"!=typeof window&&window.crypto)if(window.crypto.getRandomValues){var g=new Uint8Array(32);for(window.crypto.getRandomValues(g),l=0;l<32;++l)u[c++]=g[l]}else if("Netscape"==navigator.appName&&navigator.appVersion<"5"){var h=window.crypto.random(32);for(l=0;l<h.length;++l)u[c++]=255&h.charCodeAt(l)}for(;c<f;)l=Math.floor(65536*Math.random()),u[c++]=l>>>8,u[c++]=255&l;c=0,rng_seed_time()}function rng_get_byte(){if(null==a){for(rng_seed_time(),(a=function prng_newstate(){return new Arcfour}()).init(u),c=0;c<u.length;++c)u[c]=0;c=0}return a.next()}function SecureRandom(){}function Arcfour(){this.i=0,this.j=0,this.S=new Array}SecureRandom.prototype.nextBytes=function rng_get_bytes(e){var t;for(t=0;t<e.length;++t)e[t]=rng_get_byte()},Arcfour.prototype.init=function ARC4init(e){var t,n,i;for(t=0;t<256;++t)this.S[t]=t;for(n=0,t=0;t<256;++t)n=n+this.S[t]+e[t%e.length]&255,i=this.S[t],this.S[t]=this.S[n],this.S[n]=i;this.i=0,this.j=0},Arcfour.prototype.next=function ARC4next(){var e;return this.i=this.i+1&255,this.j=this.j+this.S[this.i]&255,e=this.S[this.i],this.S[this.i]=this.S[this.j],this.S[this.j]=e,this.S[e+this.S[this.i]&255]};var f=256;e.exports={default:BigInteger,BigInteger:BigInteger,SecureRandom:SecureRandom}}).call(this)},function(e,t,n){"use strict";t.byteLength=function byteLength(e){var t=getLens(e),n=t[0],i=t[1];return 3*(n+i)/4-i},t.toByteArray=function toByteArray(e){for(var t,n=getLens(e),i=n[0],a=n[1],u=new s(function _byteLength(e,t,n){return 3*(t+n)/4-n}(0,i,a)),c=0,d=a>0?i-4:i,p=0;p<d;p+=4)t=o[e.charCodeAt(p)]<<18|o[e.charCodeAt(p+1)]<<12|o[e.charCodeAt(p+2)]<<6|o[e.charCodeAt(p+3)],u[c++]=t>>16&255,u[c++]=t>>8&255,u[c++]=255&t;2===a&&(t=o[e.charCodeAt(p)]<<2|o[e.charCodeAt(p+1)]>>4,u[c++]=255&t);1===a&&(t=o[e.charCodeAt(p)]<<10|o[e.charCodeAt(p+1)]<<4|o[e.charCodeAt(p+2)]>>2,u[c++]=t>>8&255,u[c++]=255&t);return u},t.fromByteArray=function fromByteArray(e){for(var t,n=e.length,o=n%3,s=[],a=0,u=n-o;a<u;a+=16383)s.push(encodeChunk(e,a,a+16383>u?u:a+16383));1===o?(t=e[n-1],s.push(i[t>>2]+i[t<<4&63]+"==")):2===o&&(t=(e[n-2]<<8)+e[n-1],s.push(i[t>>10]+i[t>>4&63]+i[t<<2&63]+"="));return s.join("")};for(var i=[],o=[],s="undefined"!=typeof Uint8Array?Uint8Array:Array,a="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",u=0,c=a.length;u<c;++u)i[u]=a[u],o[a.charCodeAt(u)]=u;function getLens(e){var t=e.length;if(t%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var n=e.indexOf("=");return-1===n&&(n=t),[n,n===t?0:4-n%4]}function encodeChunk(e,t,n){for(var o,s,a=[],u=t;u<n;u+=3)o=(e[u]<<16&16711680)+(e[u+1]<<8&65280)+(255&e[u+2]),a.push(i[(s=o)>>18&63]+i[s>>12&63]+i[s>>6&63]+i[63&s]);return a.join("")}o["-".charCodeAt(0)]=62,o["_".charCodeAt(0)]=63},function(e,t,n){var i=n(5),o=n(6);e.exports=function v4(e,t,n){var s=t&&n||0;"string"==typeof e&&(t="binary"===e?new Array(16):null,e=null);var a=(e=e||{}).random||(e.rng||i)();if(a[6]=15&a[6]|64,a[8]=63&a[8]|128,t)for(var u=0;u<16;++u)t[s+u]=a[u];return t||o(a)}},function(e,t,n){var i;e.exports=(i=i||function(e,t){var n=Object.create||function(){function F(){}return function(e){var t;return F.prototype=e,t=new F,F.prototype=null,t}}(),i={},o=i.lib={},s=o.Base={extend:function(e){var t=n(this);return e&&t.mixIn(e),t.hasOwnProperty("init")&&this.init!==t.init||(t.init=function(){t.$super.init.apply(this,arguments)}),t.init.prototype=t,t.$super=this,t},create:function(){var e=this.extend();return e.init.apply(e,arguments),e},init:function(){},mixIn:function(e){for(var t in e)e.hasOwnProperty(t)&&(this[t]=e[t]);e.hasOwnProperty("toString")&&(this.toString=e.toString)},clone:function(){return this.init.prototype.extend(this)}},a=o.WordArray=s.extend({init:function(e,t){e=this.words=e||[],this.sigBytes=null!=t?t:4*e.length},toString:function(e){return(e||c).stringify(this)},concat:function(e){var t=this.words,n=e.words,i=this.sigBytes,o=e.sigBytes;if(this.clamp(),i%4)for(var s=0;s<o;s++){var a=n[s>>>2]>>>24-s%4*8&255;t[i+s>>>2]|=a<<24-(i+s)%4*8}else for(s=0;s<o;s+=4)t[i+s>>>2]=n[s>>>2];return this.sigBytes+=o,this},clamp:function(){var t=this.words,n=this.sigBytes;t[n>>>2]&=4294967295<<32-n%4*8,t.length=e.ceil(n/4)},clone:function(){var e=s.clone.call(this);return e.words=this.words.slice(0),e},random:function(t){for(var n,i=[],r=function(t){t=t;var n=987654321,i=4294967295;return function(){var o=((n=36969*(65535&n)+(n>>16)&i)<<16)+(t=18e3*(65535&t)+(t>>16)&i)&i;return o/=4294967296,(o+=.5)*(e.random()>.5?1:-1)}},o=0;o<t;o+=4){var s=r(4294967296*(n||e.random()));n=987654071*s(),i.push(4294967296*s()|0)}return new a.init(i,t)}}),u=i.enc={},c=u.Hex={stringify:function(e){for(var t=e.words,n=e.sigBytes,i=[],o=0;o<n;o++){var s=t[o>>>2]>>>24-o%4*8&255;i.push((s>>>4).toString(16)),i.push((15&s).toString(16))}return i.join("")},parse:function(e){for(var t=e.length,n=[],i=0;i<t;i+=2)n[i>>>3]|=parseInt(e.substr(i,2),16)<<24-i%8*4;return new a.init(n,t/2)}},d=u.Latin1={stringify:function(e){for(var t=e.words,n=e.sigBytes,i=[],o=0;o<n;o++){var s=t[o>>>2]>>>24-o%4*8&255;i.push(String.fromCharCode(s))}return i.join("")},parse:function(e){for(var t=e.length,n=[],i=0;i<t;i++)n[i>>>2]|=(255&e.charCodeAt(i))<<24-i%4*8;return new a.init(n,t)}},p=u.Utf8={stringify:function(e){try{return decodeURIComponent(escape(d.stringify(e)))}catch(e){throw new Error("Malformed UTF-8 data")}},parse:function(e){return d.parse(unescape(encodeURIComponent(e)))}},l=o.BufferedBlockAlgorithm=s.extend({reset:function(){this._data=new a.init,this._nDataBytes=0},_append:function(e){"string"==typeof e&&(e=p.parse(e)),this._data.concat(e),this._nDataBytes+=e.sigBytes},_process:function(t){var n=this._data,i=n.words,o=n.sigBytes,s=this.blockSize,u=o/(4*s),c=(u=t?e.ceil(u):e.max((0|u)-this._minBufferSize,0))*s,d=e.min(4*c,o);if(c){for(var p=0;p<c;p+=s)this._doProcessBlock(i,p);var l=i.splice(0,c);n.sigBytes-=d}return new a.init(l,d)},clone:function(){var e=s.clone.call(this);return e._data=this._data.clone(),e},_minBufferSize:0}),g=(o.Hasher=l.extend({cfg:s.extend(),init:function(e){this.cfg=this.cfg.extend(e),this.reset()},reset:function(){l.reset.call(this),this._doReset()},update:function(e){return this._append(e),this._process(),this},finalize:function(e){return e&&this._append(e),this._doFinalize()},blockSize:16,_createHelper:function(e){return function(t,n){return new e.init(n).finalize(t)}},_createHmacHelper:function(e){return function(t,n){return new g.HMAC.init(e,n).finalize(t)}}}),i.algo={});return i}(Math),i)},function(e,t){var n="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||"undefined"!=typeof msCrypto&&"function"==typeof window.msCrypto.getRandomValues&&msCrypto.getRandomValues.bind(msCrypto);if(n){var i=new Uint8Array(16);e.exports=function whatwgRNG(){return n(i),i}}else{var o=new Array(16);e.exports=function mathRNG(){for(var e,t=0;t<16;t++)0==(3&t)&&(e=4294967296*Math.random()),o[t]=e>>>((3&t)<<3)&255;return o}}},function(e,t){for(var n=[],i=0;i<256;++i)n[i]=(i+256).toString(16).substr(1);e.exports=function bytesToUuid(e,t){var i=t||0,o=n;return[o[e[i++]],o[e[i++]],o[e[i++]],o[e[i++]],"-",o[e[i++]],o[e[i++]],"-",o[e[i++]],o[e[i++]],"-",o[e[i++]],o[e[i++]],"-",o[e[i++]],o[e[i++]],o[e[i++]],o[e[i++]],o[e[i++]],o[e[i++]]].join("")}},function(e,t,n){"use strict";function _defineProperties(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}n.r(t);var i,o,s={debug:function debug(){},info:function info(){},warn:function warn(){},error:function error(){}},a=function(){function Log(){}return Log.reset=function reset(){o=3,i=s},Log.debug=function debug(){if(o>=4){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];i.debug.apply(i,Array.from(t))}},Log.info=function info(){if(o>=3){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];i.info.apply(i,Array.from(t))}},Log.warn=function warn(){if(o>=2){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];i.warn.apply(i,Array.from(t))}},Log.error=function error(){if(o>=1){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];i.error.apply(i,Array.from(t))}},function _createClass(e,t,n){return t&&_defineProperties(e.prototype,t),n&&_defineProperties(e,n),e}(Log,null,[{key:"NONE",get:function get(){return 0}},{key:"ERROR",get:function get(){return 1}},{key:"WARN",get:function get(){return 2}},{key:"INFO",get:function get(){return 3}},{key:"DEBUG",get:function get(){return 4}},{key:"level",get:function get(){return o},set:function set(e){if(!(0<=e&&e<=4))throw new Error("Invalid log level");o=e}},{key:"logger",get:function get(){return i},set:function set(e){if(!e.debug&&e.info&&(e.debug=e.info),!(e.debug&&e.info&&e.warn&&e.error))throw new Error("Invalid logger");i=e}}]),Log}();function Global_defineProperties(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}a.reset();var u={setInterval:function(e){function setInterval(t,n){return e.apply(this,arguments)}return setInterval.toString=function(){return e.toString()},setInterval}((function(e,t){return setInterval(e,t)})),clearInterval:function(e){function clearInterval(t){return e.apply(this,arguments)}return clearInterval.toString=function(){return e.toString()},clearInterval}((function(e){return clearInterval(e)}))},c=!1,d=null,p=function(){function Global(){}return Global._testing=function _testing(){c=!0},Global.setXMLHttpRequest=function setXMLHttpRequest(e){d=e},function Global_createClass(e,t,n){return t&&Global_defineProperties(e.prototype,t),n&&Global_defineProperties(e,n),e}(Global,null,[{key:"location",get:function get(){if(!c)return location}},{key:"localStorage",get:function get(){if(!c&&"undefined"!=typeof window)return localStorage}},{key:"sessionStorage",get:function get(){if(!c&&"undefined"!=typeof window)return sessionStorage}},{key:"XMLHttpRequest",get:function get(){if(!c&&"undefined"!=typeof window)return d||XMLHttpRequest}},{key:"timer",get:function get(){if(!c)return u}}]),Global}(),l=function(){function WebStorageStateStore(e){var t=void 0===e?{}:e,n=t.prefix,i=void 0===n?"oidc.":n,o=t.store,s=void 0===o?p.localStorage:o;this._store=s,this._prefix=i}var e=WebStorageStateStore.prototype;return e.set=function set(e,t){return a.debug("WebStorageStateStore.set",e),e=this._prefix+e,this._store.setItem(e,t),Promise.resolve()},e.get=function get(e){a.debug("WebStorageStateStore.get",e),e=this._prefix+e;var t=this._store.getItem(e);return Promise.resolve(t)},e.remove=function remove(e){a.debug("WebStorageStateStore.remove",e),e=this._prefix+e;var t=this._store.getItem(e);return this._store.removeItem(e),Promise.resolve(t)},e.getAllKeys=function getAllKeys(){a.debug("WebStorageStateStore.getAllKeys");for(var e=[],t=0;t<this._store.length;t++){var n=this._store.key(t);0===n.indexOf(this._prefix)&&e.push(n.substr(this._prefix.length))}return Promise.resolve(e)},WebStorageStateStore}(),g=function(){function JsonService(e,t,n){void 0===e&&(e=null),void 0===t&&(t=p.XMLHttpRequest),void 0===n&&(n=null),e&&Array.isArray(e)?this._contentTypes=e.slice():this._contentTypes=[],this._contentTypes.push("application/json"),n&&this._contentTypes.push("application/jwt"),this._XMLHttpRequest=t,this._jwtHandler=n}var e=JsonService.prototype;return e.getJson=function getJson(e,t){var n=this;if(!e)throw a.error("JsonService.getJson: No url passed"),new Error("url");return a.debug("JsonService.getJson, url: ",e),new Promise((function(i,o){var s=new n._XMLHttpRequest;s.open("GET",e);var u=n._contentTypes,c=n._jwtHandler;s.onload=function(){if(a.debug("JsonService.getJson: HTTP response received, status",s.status),200===s.status){var t=s.getResponseHeader("Content-Type");if(t){var n=u.find((function(e){if(t.startsWith(e))return!0}));if("application/jwt"==n)return void c(s).then(i,o);if(n)try{return void i(JSON.parse(s.responseText))}catch(e){return a.error("JsonService.getJson: Error parsing JSON response",e.message),void o(e)}}o(Error("Invalid response Content-Type: "+t+", from URL: "+e))}else o(Error(s.statusText+" ("+s.status+")"))},s.onerror=function(){a.error("JsonService.getJson: network error"),o(Error("Network Error"))},t&&(a.debug("JsonService.getJson: token passed, setting Authorization header"),s.setRequestHeader("Authorization","Bearer "+t)),s.send()}))},e.postForm=function postForm(e,t){var n=this;if(!e)throw a.error("JsonService.postForm: No url passed"),new Error("url");return a.debug("JsonService.postForm, url: ",e),new Promise((function(i,o){var s=new n._XMLHttpRequest;s.open("POST",e);var u=n._contentTypes;s.onload=function(){if(a.debug("JsonService.postForm: HTTP response received, status",s.status),200!==s.status){if(400===s.status)if(n=s.getResponseHeader("Content-Type"))if(u.find((function(e){if(n.startsWith(e))return!0})))try{var t=JSON.parse(s.responseText);if(t&&t.error)return a.error("JsonService.postForm: Error from server: ",t.error),void o(new Error(t.error))}catch(e){return a.error("JsonService.postForm: Error parsing JSON response",e.message),void o(e)}o(Error(s.statusText+" ("+s.status+")"))}else{var n;if((n=s.getResponseHeader("Content-Type"))&&u.find((function(e){if(n.startsWith(e))return!0})))try{return void i(JSON.parse(s.responseText))}catch(e){return a.error("JsonService.postForm: Error parsing JSON response",e.message),void o(e)}o(Error("Invalid response Content-Type: "+n+", from URL: "+e))}},s.onerror=function(){a.error("JsonService.postForm: network error"),o(Error("Network Error"))};var c="";for(var d in t){var p=t[d];p&&(c.length>0&&(c+="&"),c+=encodeURIComponent(d),c+="=",c+=encodeURIComponent(p))}s.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),s.send(c)}))},JsonService}();function MetadataService_defineProperties(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var h=function(){function MetadataService(e,t){if(void 0===t&&(t=g),!e)throw a.error("MetadataService: No settings passed to MetadataService"),new Error("settings");this._settings=e,this._jsonService=new t(["application/jwk-set+json"])}var e=MetadataService.prototype;return e.getMetadata=function getMetadata(){var e=this;return this._settings.metadata?(a.debug("MetadataService.getMetadata: Returning metadata from settings"),Promise.resolve(this._settings.metadata)):this.metadataUrl?(a.debug("MetadataService.getMetadata: getting metadata from",this.metadataUrl),this._jsonService.getJson(this.metadataUrl).then((function(t){return a.debug("MetadataService.getMetadata: json received"),e._settings.metadata=t,t}))):(a.error("MetadataService.getMetadata: No authority or metadataUrl configured on settings"),Promise.reject(new Error("No authority or metadataUrl configured on settings")))},e.getIssuer=function getIssuer(){return this._getMetadataProperty("issuer")},e.getAuthorizationEndpoint=function getAuthorizationEndpoint(){return this._getMetadataProperty("authorization_endpoint")},e.getUserInfoEndpoint=function getUserInfoEndpoint(){return this._getMetadataProperty("userinfo_endpoint")},e.getTokenEndpoint=function getTokenEndpoint(e){return void 0===e&&(e=!0),this._getMetadataProperty("token_endpoint",e)},e.getCheckSessionIframe=function getCheckSessionIframe(){return this._getMetadataProperty("check_session_iframe",!0)},e.getEndSessionEndpoint=function getEndSessionEndpoint(){return this._getMetadataProperty("end_session_endpoint",!0)},e.getRevocationEndpoint=function getRevocationEndpoint(){return this._getMetadataProperty("revocation_endpoint",!0)},e.getKeysEndpoint=function getKeysEndpoint(){return this._getMetadataProperty("jwks_uri",!0)},e._getMetadataProperty=function _getMetadataProperty(e,t){return void 0===t&&(t=!1),a.debug("MetadataService.getMetadataProperty for: "+e),this.getMetadata().then((function(n){if(a.debug("MetadataService.getMetadataProperty: metadata recieved"),void 0===n[e]){if(!0===t)return void a.warn("MetadataService.getMetadataProperty: Metadata does not contain optional property "+e);throw a.error("MetadataService.getMetadataProperty: Metadata does not contain property "+e),new Error("Metadata does not contain property "+e)}return n[e]}))},e.getSigningKeys=function getSigningKeys(){var e=this;return this._settings.signingKeys?(a.debug("MetadataService.getSigningKeys: Returning signingKeys from settings"),Promise.resolve(this._settings.signingKeys)):this._getMetadataProperty("jwks_uri").then((function(t){return a.debug("MetadataService.getSigningKeys: jwks_uri received",t),e._jsonService.getJson(t).then((function(t){if(a.debug("MetadataService.getSigningKeys: key set received",t),!t.keys)throw a.error("MetadataService.getSigningKeys: Missing keys on keyset"),new Error("Missing keys on keyset");return e._settings.signingKeys=t.keys,e._settings.signingKeys}))}))},function MetadataService_createClass(e,t,n){return t&&MetadataService_defineProperties(e.prototype,t),n&&MetadataService_defineProperties(e,n),e}(MetadataService,[{key:"metadataUrl",get:function get(){return this._metadataUrl||(this._settings.metadataUrl?this._metadataUrl=this._settings.metadataUrl:(this._metadataUrl=this._settings.authority,this._metadataUrl&&this._metadataUrl.indexOf(".well-known/openid-configuration")<0&&("/"!==this._metadataUrl[this._metadataUrl.length-1]&&(this._metadataUrl+="/"),this._metadataUrl+=".well-known/openid-configuration"))),this._metadataUrl}}]),MetadataService}(),f=n(1),_=n.n(f),v=n(0),m=n.n(v),y=n(2),b=n.n(y),S=_.a.BigInteger,k="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",w={b64tohex:function b64tohex(e){var t,n,i="",o=0;for(t=0;t<e.length&&"="!==e.charAt(t);++t){var s=k.indexOf(e.charAt(t));s<0||(0===o?(i+=String.fromCharCode(s>>2),n=3&s,o=1):1===o?(i+=String.fromCharCode(n<<2|s>>4),n=15&s,o=2):2===o?(i+=String.fromCharCode(n),i+=String.fromCharCode(s>>2),n=3&s,o=3):(i+=String.fromCharCode(n<<2|s>>4),i+=String.fromCharCode(15&s),o=0))}return 1===o&&(i+=String.fromCharCode(n<<2)),i},hexToBase64:function hexToBase64(e){var t,n,i="";for(t=0;t+3<=e.length;t+=3)n=parseInt(e.substring(t,t+3),16),i+=k.charAt(n>>6)+k.charAt(63&n);for(t+1===e.length?(n=parseInt(e.substring(t,t+1),16),i+=k.charAt(n<<2)):t+2===e.length&&(n=parseInt(e.substring(t,t+2),16),i+=k.charAt(n>>2)+k.charAt((3&n)<<4)),"=";(3&i.length)>0;)i+="=";return i},padding:function padding(e){var t=e.length%4;return 0===t?e:e+new Array(1+(4-t)).join("=")},byteArrayToHex:function byteArrayToHex(e){for(var t="",n=0;n<e.length;n++){var i=e[n].toString(16);t+=2===i.length?i:"0"+i}return t},decodeToHEX:function decodeToHEX(e){return w.byteArrayToHex(b.a.toByteArray(w.padding(e)))},base64ToBase64Url:function base64ToBase64Url(e){return e=(e=(e=e.replace(/=/g,"")).replace(/\+/g,"-")).replace(/\//g,"_")},urlDecode:function urlDecode(e){return e=e.replace(/-/g,"+").replace(/_/g,"/").replace(/\s/g," "),atob(e)}},T={sha1:"3021300906052b0e03021a05000414",sha224:"302d300d06096086480165030402040500041c",sha256:"3031300d060960864801650304020105000420",sha384:"3041300d060960864801650304020205000430",sha512:"3051300d060960864801650304020305000440",md2:"3020300c06082a864886f70d020205000410",md5:"3020300c06082a864886f70d020505000410",ripemd160:"3021300906052b2403020105000414"},I={sha256:m.a,SHA256:m.a};function RSAVerifier(e,t){if(this.n=null,this.e=0,!(null!=e&&null!=t&&e.length>0&&t.length>0))throw new Error("Invalid key data");this.n=new S(e,16),this.e=parseInt(t,16)}RSAVerifier.prototype.verify=function(e,t){t=(t=w.decodeToHEX(t)).replace(/[^0-9a-f]|[\s\n]]/gi,"");var n=new S(t,16);if(n.bitLength()>this.n.bitLength())throw new Error("Signature does not match with the key modulus.");var i=function getAlgorithmFromDigest(e){for(var t in T){var n=T[t],i=n.length;if(e.substring(0,i)===n)return{alg:t,hash:e.substring(i)}}return[]}(n.modPowInt(this.e,this.n).toString(16).replace(/^1f+00/,""));if(0===i.length)return!1;if(!I.hasOwnProperty(i.alg))throw new Error("Hashing algorithm is not supported.");var o=I[i.alg](e).toString();return i.hash===o};var P=["RS256"];var R=function getJoseUtil(e){var t=e.jws,n=e.KeyUtil,i=e.X509,o=e.crypto,s=e.hextob64u,u=e.b64tohex,c=e.AllowedSigningAlgs;return function(){function JoseUtil(){}return JoseUtil.parseJwt=function parseJwt(e){a.debug("JoseUtil.parseJwt");try{var n=t.JWS.parse(e);return{header:n.headerObj,payload:n.payloadObj}}catch(e){a.error(e)}},JoseUtil.validateJwt=function validateJwt(e,t,o,s,c,d,p){a.debug("JoseUtil.validateJwt");try{if("RSA"===t.kty)if(t.e&&t.n)t=n.getKey(t);else{if(!t.x5c||!t.x5c.length)return a.error("JoseUtil.validateJwt: RSA key missing key material",t),Promise.reject(new Error("RSA key missing key material"));var l=u(t.x5c[0]);t=i.getPublicKeyFromCertHex(l)}else{if("EC"!==t.kty)return a.error("JoseUtil.validateJwt: Unsupported key type",t&&t.kty),Promise.reject(new Error(t.kty));if(!(t.crv&&t.x&&t.y))return a.error("JoseUtil.validateJwt: EC key missing key material",t),Promise.reject(new Error("EC key missing key material"));t=n.getKey(t)}return JoseUtil._validateJwt(e,t,o,s,c,d,p)}catch(e){return a.error(e&&e.message||e),Promise.reject("JWT validation failed")}},JoseUtil.validateJwtAttributes=function validateJwtAttributes(e,t,n,i,o,s){i||(i=0),o||(o=parseInt(Date.now()/1e3));var u=JoseUtil.parseJwt(e).payload;if(!u.iss)return a.error("JoseUtil._validateJwt: issuer was not provided"),Promise.reject(new Error("issuer was not provided"));if(u.iss!==t)return a.error("JoseUtil._validateJwt: Invalid issuer in token",u.iss),Promise.reject(new Error("Invalid issuer in token: "+u.iss));if(!u.aud)return a.error("JoseUtil._validateJwt: aud was not provided"),Promise.reject(new Error("aud was not provided"));if(!(u.aud===n||Array.isArray(u.aud)&&u.aud.indexOf(n)>=0))return a.error("JoseUtil._validateJwt: Invalid audience in token",u.aud),Promise.reject(new Error("Invalid audience in token: "+u.aud));if(u.azp&&u.azp!==n)return a.error("JoseUtil._validateJwt: Invalid azp in token",u.azp),Promise.reject(new Error("Invalid azp in token: "+u.azp));if(!s){var c=o+i,d=o-i;if(!u.iat)return a.error("JoseUtil._validateJwt: iat was not provided"),Promise.reject(new Error("iat was not provided"));if(c<u.iat)return a.error("JoseUtil._validateJwt: iat is in the future",u.iat),Promise.reject(new Error("iat is in the future: "+u.iat));if(u.nbf&&c<u.nbf)return a.error("JoseUtil._validateJwt: nbf is in the future",u.nbf),Promise.reject(new Error("nbf is in the future: "+u.nbf));if(!u.exp)return a.error("JoseUtil._validateJwt: exp was not provided"),Promise.reject(new Error("exp was not provided"));if(u.exp<d)return a.error("JoseUtil._validateJwt: exp is in the past",u.exp),Promise.reject(new Error("exp is in the past:"+u.exp))}return Promise.resolve(u)},JoseUtil._validateJwt=function _validateJwt(e,n,i,o,s,u,d){return JoseUtil.validateJwtAttributes(e,i,o,s,u,d).then((function(i){try{return t.JWS.verify(e,n,c)?i:(a.error("JoseUtil._validateJwt: signature validation failed"),Promise.reject(new Error("signature validation failed")))}catch(e){return a.error(e&&e.message||e),Promise.reject(new Error("signature validation failed"))}}))},JoseUtil.hashString=function hashString(e,t){try{return o.Util.hashString(e,t)}catch(e){a.error(e)}},JoseUtil.hexToBase64Url=function hexToBase64Url(e){try{return s(e)}catch(e){a.error(e)}},JoseUtil}()}({jws:{JWS:{parse:function parse(e){var t,n,i=e.split(".");if(3===i.length){try{t=JSON.parse(w.urlDecode(i[0])),n=JSON.parse(w.urlDecode(i[1]))}catch(e){return new Error("Token header or payload is not valid JSON")}return{headerObj:t,payloadObj:n}}},verify:function verify(e,t,n){void 0===n&&(n=[]),n.forEach((function(e){if(-1===P.indexOf(e))throw new Error("Invalid signing algorithm: "+e)}));var verify=new RSAVerifier(t.n,t.e),i=e.split("."),o=[i[0],i[1]].join(".");return verify.verify(o,i[2])}}},KeyUtil:{getKey:function getKey(e){return"RSA"===e.kty?{e:w.decodeToHEX(e.e),n:w.decodeToHEX(e.n)}:null}},X509:{getPublicKeyFromCertPEM:function getPublicKeyFromCertPEM(){throw new Error("Not implemented. Use the full oidc-client library if you need support for X509.")}},crypto:{Util:{hashString:function hashString(e,t){return(0,I[t])(e).toString()}}},hextob64u:function rsa_hextob64u(e){return e.length%2==1&&(e="0"+e),w.base64ToBase64Url(w.hexToBase64(e))},b64tohex:w.b64tohex,AllowedSigningAlgs:P}),C=function(){function UserInfoService(e,t,n,i){if(void 0===t&&(t=g),void 0===n&&(n=h),void 0===i&&(i=R),!e)throw a.error("UserInfoService.ctor: No settings passed"),new Error("settings");this._settings=e,this._jsonService=new t(void 0,void 0,this._getClaimsFromJwt.bind(this)),this._metadataService=new n(this._settings),this._joseUtil=i}var e=UserInfoService.prototype;return e.getClaims=function getClaims(e){var t=this;return e?this._metadataService.getUserInfoEndpoint().then((function(n){return a.debug("UserInfoService.getClaims: received userinfo url",n),t._jsonService.getJson(n,e).then((function(e){return a.debug("UserInfoService.getClaims: claims received",e),e}))})):(a.error("UserInfoService.getClaims: No token passed"),Promise.reject(new Error("A token is required")))},e._getClaimsFromJwt=function _getClaimsFromJwt(e){var t=this;try{var n=this._joseUtil.parseJwt(e.responseText);if(!n||!n.header||!n.payload)return a.error("UserInfoService._getClaimsFromJwt: Failed to parse JWT",n),Promise.reject(new Error("Failed to parse id_token"));var i,o=n.header.kid;switch(this._settings.userInfoJwtIssuer){case"OP":i=this._metadataService.getIssuer();break;case"ANY":i=Promise.resolve(n.payload.iss);break;default:i=Promise.resolve(this._settings.userInfoJwtIssuer)}return i.then((function(i){return a.debug("UserInfoService._getClaimsFromJwt: Received issuer:"+i),t._metadataService.getSigningKeys().then((function(s){if(!s)return a.error("UserInfoService._getClaimsFromJwt: No signing keys from metadata"),Promise.reject(new Error("No signing keys from metadata"));var u;if(a.debug("UserInfoService._getClaimsFromJwt: Received signing keys"),o)u=s.filter((function(e){return e.kid===o}))[0];else{if((s=t._filterByAlg(s,n.header.alg)).length>1)return a.error("UserInfoService._getClaimsFromJwt: No kid found in id_token and more than one key found in metadata"),Promise.reject(new Error("No kid found in id_token and more than one key found in metadata"));u=s[0]}if(!u)return a.error("UserInfoService._getClaimsFromJwt: No key matching kid or alg found in signing keys"),Promise.reject(new Error("No key matching kid or alg found in signing keys"));var c=t._settings.client_id,d=t._settings.clockSkew;return a.debug("UserInfoService._getClaimsFromJwt: Validaing JWT; using clock skew (in seconds) of: ",d),t._joseUtil.validateJwt(e.responseText,u,i,c,d,void 0,!0).then((function(){return a.debug("UserInfoService._getClaimsFromJwt: JWT validation successful"),n.payload}))}))}))}catch(e){return a.error("UserInfoService._getClaimsFromJwt: Error parsing JWT response",e.message),void reject(e)}},e._filterByAlg=function _filterByAlg(e,t){var n=null;if(t.startsWith("RS"))n="RSA";else if(t.startsWith("PS"))n="PS";else{if(!t.startsWith("ES"))return a.debug("UserInfoService._filterByAlg: alg not supported: ",t),[];n="EC"}return a.debug("UserInfoService._filterByAlg: Looking for keys that match kty: ",n),e=e.filter((function(e){return e.kty===n})),a.debug("UserInfoService._filterByAlg: Number of keys that match kty: ",n,e.length),e},UserInfoService}(),U=function(){function TokenClient(e,t,n){if(void 0===t&&(t=g),void 0===n&&(n=h),!e)throw a.error("TokenClient.ctor: No settings passed"),new Error("settings");this._settings=e,this._jsonService=new t,this._metadataService=new n(this._settings)}var e=TokenClient.prototype;return e.exchangeCode=function exchangeCode(e){var t=this;return void 0===e&&(e={}),(e=Object.assign({},e)).grant_type=e.grant_type||"authorization_code",e.client_id=e.client_id||this._settings.client_id,e.redirect_uri=e.redirect_uri||this._settings.redirect_uri,e.code?e.redirect_uri?e.code_verifier?e.client_id?this._metadataService.getTokenEndpoint(!1).then((function(n){return a.debug("TokenClient.exchangeCode: Received token endpoint"),t._jsonService.postForm(n,e).then((function(e){return a.debug("TokenClient.exchangeCode: response received"),e}))})):(a.error("TokenClient.exchangeCode: No client_id passed"),Promise.reject(new Error("A client_id is required"))):(a.error("TokenClient.exchangeCode: No code_verifier passed"),Promise.reject(new Error("A code_verifier is required"))):(a.error("TokenClient.exchangeCode: No redirect_uri passed"),Promise.reject(new Error("A redirect_uri is required"))):(a.error("TokenClient.exchangeCode: No code passed"),Promise.reject(new Error("A code is required")))},e.exchangeRefreshToken=function exchangeRefreshToken(e){var t=this;return void 0===e&&(e={}),(e=Object.assign({},e)).grant_type=e.grant_type||"refresh_token",e.client_id=e.client_id||this._settings.client_id,e.client_secret=e.client_secret||this._settings.client_secret,e.refresh_token?e.client_id?this._metadataService.getTokenEndpoint(!1).then((function(n){return a.debug("TokenClient.exchangeRefreshToken: Received token endpoint"),t._jsonService.postForm(n,e).then((function(e){return a.debug("TokenClient.exchangeRefreshToken: response received"),e}))})):(a.error("TokenClient.exchangeRefreshToken: No client_id passed"),Promise.reject(new Error("A client_id is required"))):(a.error("TokenClient.exchangeRefreshToken: No refresh_token passed"),Promise.reject(new Error("A refresh_token is required")))},TokenClient}();function _wrapNativeSuper(e){var t="function"==typeof Map?new Map:void 0;return(_wrapNativeSuper=function _wrapNativeSuper(e){if(null===e||!function _isNativeFunction(e){return-1!==Function.toString.call(e).indexOf("[native code]")}(e))return e;if("function"!=typeof e)throw new TypeError("Super expression must either be null or a function");if(void 0!==t){if(t.has(e))return t.get(e);t.set(e,Wrapper)}function Wrapper(){return _construct(e,arguments,_getPrototypeOf(this).constructor)}return Wrapper.prototype=Object.create(e.prototype,{constructor:{value:Wrapper,enumerable:!1,writable:!0,configurable:!0}}),_setPrototypeOf(Wrapper,e)})(e)}function _construct(e,t,n){return(_construct=_isNativeReflectConstruct()?Reflect.construct:function _construct(e,t,n){var i=[null];i.push.apply(i,t);var o=new(Function.bind.apply(e,i));return n&&_setPrototypeOf(o,n.prototype),o}).apply(null,arguments)}function _isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}function _setPrototypeOf(e,t){return(_setPrototypeOf=Object.setPrototypeOf||function _setPrototypeOf(e,t){return e.__proto__=t,e})(e,t)}function _getPrototypeOf(e){return(_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function _getPrototypeOf(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var E=function(e){function ErrorResponse(t){var n,i=void 0===t?{}:t,o=i.error,s=i.error_description,u=i.error_uri,c=i.state,d=i.session_state;if(!o)throw a.error("No error passed to ErrorResponse"),new Error("error");return(n=e.call(this,s||o)||this).name="ErrorResponse",n.error=o,n.error_description=s,n.error_uri=u,n.state=c,n.session_state=d,n}return function _inheritsLoose(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e,e.__proto__=t}(ErrorResponse,e),ErrorResponse}(_wrapNativeSuper(Error)),M=["nonce","at_hash","iat","nbf","exp","aud","iss","c_hash"],x=function(){function ResponseValidator(e,t,n,i,o){if(void 0===t&&(t=h),void 0===n&&(n=C),void 0===i&&(i=R),void 0===o&&(o=U),!e)throw a.error("ResponseValidator.ctor: No settings passed to ResponseValidator"),new Error("settings");this._settings=e,this._metadataService=new t(this._settings),this._userInfoService=new n(this._settings),this._joseUtil=i,this._tokenClient=new o(this._settings)}var e=ResponseValidator.prototype;return e.validateSigninResponse=function validateSigninResponse(e,t){var n=this;return a.debug("ResponseValidator.validateSigninResponse"),this._processSigninParams(e,t).then((function(t){return a.debug("ResponseValidator.validateSigninResponse: state processed"),n._validateTokens(e,t).then((function(t){return a.debug("ResponseValidator.validateSigninResponse: tokens validated"),n._processClaims(e,t).then((function(e){return a.debug("ResponseValidator.validateSigninResponse: claims processed"),e}))}))}))},e.validateSignoutResponse=function validateSignoutResponse(e,t){return e.id!==t.state?(a.error("ResponseValidator.validateSignoutResponse: State does not match"),Promise.reject(new Error("State does not match"))):(a.debug("ResponseValidator.validateSignoutResponse: state validated"),t.state=e.data,t.error?(a.warn("ResponseValidator.validateSignoutResponse: Response was error",t.error),Promise.reject(new E(t))):Promise.resolve(t))},e._processSigninParams=function _processSigninParams(e,t){if(e.id!==t.state)return a.error("ResponseValidator._processSigninParams: State does not match"),Promise.reject(new Error("State does not match"));if(!e.client_id)return a.error("ResponseValidator._processSigninParams: No client_id on state"),Promise.reject(new Error("No client_id on state"));if(!e.authority)return a.error("ResponseValidator._processSigninParams: No authority on state"),Promise.reject(new Error("No authority on state"));if(this._settings.authority){if(this._settings.authority&&this._settings.authority!==e.authority)return a.error("ResponseValidator._processSigninParams: authority mismatch on settings vs. signin state"),Promise.reject(new Error("authority mismatch on settings vs. signin state"))}else this._settings.authority=e.authority;if(this._settings.client_id){if(this._settings.client_id&&this._settings.client_id!==e.client_id)return a.error("ResponseValidator._processSigninParams: client_id mismatch on settings vs. signin state"),Promise.reject(new Error("client_id mismatch on settings vs. signin state"))}else this._settings.client_id=e.client_id;return a.debug("ResponseValidator._processSigninParams: state validated"),t.state=e.data,t.error?(a.warn("ResponseValidator._processSigninParams: Response was error",t.error),Promise.reject(new E(t))):e.nonce&&!t.id_token?(a.error("ResponseValidator._processSigninParams: Expecting id_token in response"),Promise.reject(new Error("No id_token in response"))):!e.nonce&&t.id_token?(a.error("ResponseValidator._processSigninParams: Not expecting id_token in response"),Promise.reject(new Error("Unexpected id_token in response"))):e.code_verifier&&!t.code?(a.error("ResponseValidator._processSigninParams: Expecting code in response"),Promise.reject(new Error("No code in response"))):!e.code_verifier&&t.code?(a.error("ResponseValidator._processSigninParams: Not expecting code in response"),Promise.reject(new Error("Unexpected code in response"))):(t.scope||(t.scope=e.scope),Promise.resolve(t))},e._processClaims=function _processClaims(e,t){var n=this;if(t.isOpenIdConnect){if(a.debug("ResponseValidator._processClaims: response is OIDC, processing claims"),t.profile=this._filterProtocolClaims(t.profile),!0!==e.skipUserInfo&&this._settings.loadUserInfo&&t.access_token)return a.debug("ResponseValidator._processClaims: loading user info"),this._userInfoService.getClaims(t.access_token).then((function(e){return a.debug("ResponseValidator._processClaims: user info claims received from user info endpoint"),e.sub!==t.profile.sub?(a.error("ResponseValidator._processClaims: sub from user info endpoint does not match sub in access_token"),Promise.reject(new Error("sub from user info endpoint does not match sub in access_token"))):(t.profile=n._mergeClaims(t.profile,e),a.debug("ResponseValidator._processClaims: user info claims received, updated profile:",t.profile),t)}));a.debug("ResponseValidator._processClaims: not loading user info")}else a.debug("ResponseValidator._processClaims: response is not OIDC, not processing claims");return Promise.resolve(t)},e._mergeClaims=function _mergeClaims(e,t){var n=Object.assign({},e);for(var i in t){var o=t[i];Array.isArray(o)||(o=[o]);for(var s=0;s<o.length;s++){var a=o[s];n[i]?Array.isArray(n[i])?n[i].indexOf(a)<0&&n[i].push(a):n[i]!==a&&(n[i]="object"==typeof a?this._mergeClaims(n[i],a):[n[i],a]):n[i]=a}}return n},e._filterProtocolClaims=function _filterProtocolClaims(e){a.debug("ResponseValidator._filterProtocolClaims, incoming claims:",e);var t=Object.assign({},e);return this._settings._filterProtocolClaims?(M.forEach((function(e){delete t[e]})),a.debug("ResponseValidator._filterProtocolClaims: protocol claims filtered",t)):a.debug("ResponseValidator._filterProtocolClaims: protocol claims not filtered"),t},e._validateTokens=function _validateTokens(e,t){return t.code?(a.debug("ResponseValidator._validateTokens: Validating code"),this._processCode(e,t)):t.id_token?t.access_token?(a.debug("ResponseValidator._validateTokens: Validating id_token and access_token"),this._validateIdTokenAndAccessToken(e,t)):(a.debug("ResponseValidator._validateTokens: Validating id_token"),this._validateIdToken(e,t)):(a.debug("ResponseValidator._validateTokens: No code to process or id_token to validate"),Promise.resolve(t))},e._processCode=function _processCode(e,t){var n=this,i={client_id:e.client_id,client_secret:e.client_secret,code:t.code,redirect_uri:e.redirect_uri,code_verifier:e.code_verifier};return e.extraTokenParams&&"object"==typeof e.extraTokenParams&&Object.assign(i,e.extraTokenParams),this._tokenClient.exchangeCode(i).then((function(i){for(var o in i)t[o]=i[o];return t.id_token?(a.debug("ResponseValidator._processCode: token response successful, processing id_token"),n._validateIdTokenAttributes(e,t)):(a.debug("ResponseValidator._processCode: token response successful, returning response"),t)}))},e._validateIdTokenAttributes=function _validateIdTokenAttributes(e,t){var n=this;return this._metadataService.getIssuer().then((function(i){var o=e.client_id,s=n._settings.clockSkew;return a.debug("ResponseValidator._validateIdTokenAttributes: Validaing JWT attributes; using clock skew (in seconds) of: ",s),n._joseUtil.validateJwtAttributes(t.id_token,i,o,s).then((function(n){return e.nonce&&e.nonce!==n.nonce?(a.error("ResponseValidator._validateIdTokenAttributes: Invalid nonce in id_token"),Promise.reject(new Error("Invalid nonce in id_token"))):n.sub?(t.profile=n,t):(a.error("ResponseValidator._validateIdTokenAttributes: No sub present in id_token"),Promise.reject(new Error("No sub present in id_token")))}))}))},e._validateIdTokenAndAccessToken=function _validateIdTokenAndAccessToken(e,t){var n=this;return this._validateIdToken(e,t).then((function(e){return n._validateAccessToken(e)}))},e._validateIdToken=function _validateIdToken(e,t){var n=this;if(!e.nonce)return a.error("ResponseValidator._validateIdToken: No nonce on state"),Promise.reject(new Error("No nonce on state"));var i=this._joseUtil.parseJwt(t.id_token);if(!i||!i.header||!i.payload)return a.error("ResponseValidator._validateIdToken: Failed to parse id_token",i),Promise.reject(new Error("Failed to parse id_token"));if(e.nonce!==i.payload.nonce)return a.error("ResponseValidator._validateIdToken: Invalid nonce in id_token"),Promise.reject(new Error("Invalid nonce in id_token"));var o=i.header.kid;return this._metadataService.getIssuer().then((function(s){return a.debug("ResponseValidator._validateIdToken: Received issuer"),n._metadataService.getSigningKeys().then((function(u){if(!u)return a.error("ResponseValidator._validateIdToken: No signing keys from metadata"),Promise.reject(new Error("No signing keys from metadata"));var c;if(a.debug("ResponseValidator._validateIdToken: Received signing keys"),o)c=u.filter((function(e){return e.kid===o}))[0];else{if((u=n._filterByAlg(u,i.header.alg)).length>1)return a.error("ResponseValidator._validateIdToken: No kid found in id_token and more than one key found in metadata"),Promise.reject(new Error("No kid found in id_token and more than one key found in metadata"));c=u[0]}if(!c)return a.error("ResponseValidator._validateIdToken: No key matching kid or alg found in signing keys"),Promise.reject(new Error("No key matching kid or alg found in signing keys"));var d=e.client_id,p=n._settings.clockSkew;return a.debug("ResponseValidator._validateIdToken: Validaing JWT; using clock skew (in seconds) of: ",p),n._joseUtil.validateJwt(t.id_token,c,s,d,p).then((function(){return a.debug("ResponseValidator._validateIdToken: JWT validation successful"),i.payload.sub?(t.profile=i.payload,t):(a.error("ResponseValidator._validateIdToken: No sub present in id_token"),Promise.reject(new Error("No sub present in id_token")))}))}))}))},e._filterByAlg=function _filterByAlg(e,t){var n=null;if(t.startsWith("RS"))n="RSA";else if(t.startsWith("PS"))n="PS";else{if(!t.startsWith("ES"))return a.debug("ResponseValidator._filterByAlg: alg not supported: ",t),[];n="EC"}return a.debug("ResponseValidator._filterByAlg: Looking for keys that match kty: ",n),e=e.filter((function(e){return e.kty===n})),a.debug("ResponseValidator._filterByAlg: Number of keys that match kty: ",n,e.length),e},e._validateAccessToken=function _validateAccessToken(e){if(!e.profile)return a.error("ResponseValidator._validateAccessToken: No profile loaded from id_token"),Promise.reject(new Error("No profile loaded from id_token"));if(!e.profile.at_hash)return a.error("ResponseValidator._validateAccessToken: No at_hash in id_token"),Promise.reject(new Error("No at_hash in id_token"));if(!e.id_token)return a.error("ResponseValidator._validateAccessToken: No id_token"),Promise.reject(new Error("No id_token"));var t=this._joseUtil.parseJwt(e.id_token);if(!t||!t.header)return a.error("ResponseValidator._validateAccessToken: Failed to parse id_token",t),Promise.reject(new Error("Failed to parse id_token"));var n=t.header.alg;if(!n||5!==n.length)return a.error("ResponseValidator._validateAccessToken: Unsupported alg:",n),Promise.reject(new Error("Unsupported alg: "+n));var i=n.substr(2,3);if(!i)return a.error("ResponseValidator._validateAccessToken: Unsupported alg:",n,i),Promise.reject(new Error("Unsupported alg: "+n));if(256!==(i=parseInt(i))&&384!==i&&512!==i)return a.error("ResponseValidator._validateAccessToken: Unsupported alg:",n,i),Promise.reject(new Error("Unsupported alg: "+n));var o="sha"+i,s=this._joseUtil.hashString(e.access_token,o);if(!s)return a.error("ResponseValidator._validateAccessToken: access_token hash failed:",o),Promise.reject(new Error("Failed to validate at_hash"));var u=s.substr(0,s.length/2),c=this._joseUtil.hexToBase64Url(u);return c!==e.profile.at_hash?(a.error("ResponseValidator._validateAccessToken: Failed to validate at_hash",c,e.profile.at_hash),Promise.reject(new Error("Failed to validate at_hash"))):(a.debug("ResponseValidator._validateAccessToken: success"),Promise.resolve(e))},ResponseValidator}();function OidcClientSettings_defineProperties(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var B=function(){function OidcClientSettings(e){var t=void 0===e?{}:e,n=t.authority,i=t.metadataUrl,o=t.metadata,s=t.signingKeys,a=t.client_id,u=t.client_secret,c=t.response_type,d=void 0===c?"id_token":c,p=t.scope,g=void 0===p?"openid":p,f=t.redirect_uri,_=t.post_logout_redirect_uri,v=t.prompt,m=t.display,y=t.max_age,b=t.ui_locales,S=t.acr_values,k=t.resource,w=t.response_mode,T=t.filterProtocolClaims,I=void 0===T||T,P=t.loadUserInfo,R=void 0===P||P,C=t.staleStateAge,U=void 0===C?900:C,E=t.clockSkew,M=void 0===E?300:E,B=t.userInfoJwtIssuer,O=void 0===B?"OP":B,A=t.stateStore,N=void 0===A?new l:A,j=t.ResponseValidatorCtor,q=void 0===j?x:j,J=t.MetadataServiceCtor,W=void 0===J?h:J,D=t.extraQueryParams,V=void 0===D?{}:D,L=t.extraTokenParams,H=void 0===L?{}:L;this._authority=n,this._metadataUrl=i,this._metadata=o,this._signingKeys=s,this._client_id=a,this._client_secret=u,this._response_type=d,this._scope=g,this._redirect_uri=f,this._post_logout_redirect_uri=_,this._prompt=v,this._display=m,this._max_age=y,this._ui_locales=b,this._acr_values=S,this._resource=k,this._response_mode=w,this._filterProtocolClaims=!!I,this._loadUserInfo=!!R,this._staleStateAge=U,this._clockSkew=M,this._userInfoJwtIssuer=O,this._stateStore=N,this._validator=new q(this),this._metadataService=new W(this),this._extraQueryParams="object"==typeof V?V:{},this._extraTokenParams="object"==typeof H?H:{}}return function OidcClientSettings_createClass(e,t,n){return t&&OidcClientSettings_defineProperties(e.prototype,t),n&&OidcClientSettings_defineProperties(e,n),e}(OidcClientSettings,[{key:"client_id",get:function get(){return this._client_id},set:function set(e){if(this._client_id)throw a.error("OidcClientSettings.set_client_id: client_id has already been assigned."),new Error("client_id has already been assigned.");this._client_id=e}},{key:"client_secret",get:function get(){return this._client_secret}},{key:"response_type",get:function get(){return this._response_type}},{key:"scope",get:function get(){return this._scope}},{key:"redirect_uri",get:function get(){return this._redirect_uri}},{key:"post_logout_redirect_uri",get:function get(){return this._post_logout_redirect_uri}},{key:"prompt",get:function get(){return this._prompt}},{key:"display",get:function get(){return this._display}},{key:"max_age",get:function get(){return this._max_age}},{key:"ui_locales",get:function get(){return this._ui_locales}},{key:"acr_values",get:function get(){return this._acr_values}},{key:"resource",get:function get(){return this._resource}},{key:"response_mode",get:function get(){return this._response_mode}},{key:"authority",get:function get(){return this._authority},set:function set(e){if(this._authority)throw a.error("OidcClientSettings.set_authority: authority has already been assigned."),new Error("authority has already been assigned.");this._authority=e}},{key:"metadataUrl",get:function get(){return this._metadataUrl||(this._metadataUrl=this.authority,this._metadataUrl&&this._metadataUrl.indexOf(".well-known/openid-configuration")<0&&("/"!==this._metadataUrl[this._metadataUrl.length-1]&&(this._metadataUrl+="/"),this._metadataUrl+=".well-known/openid-configuration")),this._metadataUrl}},{key:"metadata",get:function get(){return this._metadata},set:function set(e){this._metadata=e}},{key:"signingKeys",get:function get(){return this._signingKeys},set:function set(e){this._signingKeys=e}},{key:"filterProtocolClaims",get:function get(){return this._filterProtocolClaims}},{key:"loadUserInfo",get:function get(){return this._loadUserInfo}},{key:"staleStateAge",get:function get(){return this._staleStateAge}},{key:"clockSkew",get:function get(){return this._clockSkew}},{key:"userInfoJwtIssuer",get:function get(){return this._userInfoJwtIssuer}},{key:"stateStore",get:function get(){return this._stateStore}},{key:"validator",get:function get(){return this._validator}},{key:"metadataService",get:function get(){return this._metadataService}},{key:"extraQueryParams",get:function get(){return this._extraQueryParams},set:function set(e){this._extraQueryParams="object"==typeof e?e:{}}},{key:"extraTokenParams",get:function get(){return this._extraTokenParams},set:function set(e){this._extraTokenParams="object"==typeof e?e:{}}}]),OidcClientSettings}(),O=function(){function UrlUtility(){}return UrlUtility.addQueryParam=function addQueryParam(e,t,n){return e.indexOf("?")<0&&(e+="?"),"?"!==e[e.length-1]&&(e+="&"),e+=encodeURIComponent(t),e+="=",e+=encodeURIComponent(n)},UrlUtility.parseUrlFragment=function parseUrlFragment(e,t,n){void 0===t&&(t="#"),void 0===n&&(n=p),"string"!=typeof e&&(e=n.location.href);var i=e.lastIndexOf(t);i>=0&&(e=e.substr(i+1)),"?"===t&&(i=e.indexOf("#"))>=0&&(e=e.substr(0,i));for(var o,s={},u=/([^&=]+)=([^&]*)/g,c=0;o=u.exec(e);)if(s[decodeURIComponent(o[1])]=decodeURIComponent(o[2]),c++>50)return a.error("UrlUtility.parseUrlFragment: response exceeded expected number of parameters",e),{error:"Response exceeded expected number of parameters"};for(var d in s)return s;return{}},UrlUtility}(),A=n(3),N=n.n(A);function random(){return N()().replace(/-/g,"")}function State_defineProperties(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var j=function(){function State(e){var t=void 0===e?{}:e,n=t.id,i=t.data,o=t.created,s=t.request_type;this._id=n||random(),this._data=i,this._created="number"==typeof o&&o>0?o:parseInt(Date.now()/1e3),this._request_type=s}return State.prototype.toStorageString=function toStorageString(){return a.debug("State.toStorageString"),JSON.stringify({id:this.id,data:this.data,created:this.created,request_type:this.request_type})},State.fromStorageString=function fromStorageString(e){return a.debug("State.fromStorageString"),new State(JSON.parse(e))},State.clearStaleState=function clearStaleState(e,t){var n=Date.now()/1e3-t;return e.getAllKeys().then((function(t){a.debug("State.clearStaleState: got keys",t);for(var i=[],o=function _loop(o){var s=t[o];u=e.get(s).then((function(t){var i=!1;if(t)try{var o=State.fromStorageString(t);a.debug("State.clearStaleState: got item from key: ",s,o.created),o.created<=n&&(i=!0)}catch(e){a.error("State.clearStaleState: Error parsing state for key",s,e.message),i=!0}else a.debug("State.clearStaleState: no item in storage for key: ",s),i=!0;if(i)return a.debug("State.clearStaleState: removed item for key: ",s),e.remove(s)})),i.push(u)},s=0;s<t.length;s++){var u;o(s)}return a.debug("State.clearStaleState: waiting on promise count:",i.length),Promise.all(i)}))},function State_createClass(e,t,n){return t&&State_defineProperties(e.prototype,t),n&&State_defineProperties(e,n),e}(State,[{key:"id",get:function get(){return this._id}},{key:"data",get:function get(){return this._data}},{key:"created",get:function get(){return this._created}},{key:"request_type",get:function get(){return this._request_type}}]),State}();function SigninState_defineProperties(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var q=function(e){function SigninState(t){var n,i=void 0===t?{}:t,o=i.nonce,s=i.authority,a=i.client_id,u=i.redirect_uri,c=i.code_verifier,d=i.response_mode,p=i.client_secret,l=i.scope,g=i.extraTokenParams,h=i.skipUserInfo;if(n=e.call(this,arguments[0])||this,!0===o?n._nonce=random():o&&(n._nonce=o),!0===c?n._code_verifier=random()+random()+random():c&&(n._code_verifier=c),n.code_verifier){var f=R.hashString(n.code_verifier,"SHA256");n._code_challenge=R.hexToBase64Url(f)}return n._redirect_uri=u,n._authority=s,n._client_id=a,n._response_mode=d,n._client_secret=p,n._scope=l,n._extraTokenParams=g,n._skipUserInfo=h,n}return function SigninState_inheritsLoose(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e,e.__proto__=t}(SigninState,e),SigninState.prototype.toStorageString=function toStorageString(){return a.debug("SigninState.toStorageString"),JSON.stringify({id:this.id,data:this.data,created:this.created,request_type:this.request_type,nonce:this.nonce,code_verifier:this.code_verifier,redirect_uri:this.redirect_uri,authority:this.authority,client_id:this.client_id,response_mode:this.response_mode,client_secret:this.client_secret,scope:this.scope,extraTokenParams:this.extraTokenParams,skipUserInfo:this.skipUserInfo})},SigninState.fromStorageString=function fromStorageString(e){return a.debug("SigninState.fromStorageString"),new SigninState(JSON.parse(e))},function SigninState_createClass(e,t,n){return t&&SigninState_defineProperties(e.prototype,t),n&&SigninState_defineProperties(e,n),e}(SigninState,[{key:"nonce",get:function get(){return this._nonce}},{key:"authority",get:function get(){return this._authority}},{key:"client_id",get:function get(){return this._client_id}},{key:"redirect_uri",get:function get(){return this._redirect_uri}},{key:"code_verifier",get:function get(){return this._code_verifier}},{key:"code_challenge",get:function get(){return this._code_challenge}},{key:"response_mode",get:function get(){return this._response_mode}},{key:"client_secret",get:function get(){return this._client_secret}},{key:"scope",get:function get(){return this._scope}},{key:"extraTokenParams",get:function get(){return this._extraTokenParams}},{key:"skipUserInfo",get:function get(){return this._skipUserInfo}}]),SigninState}(j),J=function(){function SigninRequest(e){var t=e.url,n=e.client_id,i=e.redirect_uri,o=e.response_type,s=e.scope,u=e.authority,c=e.data,d=e.prompt,p=e.display,l=e.max_age,g=e.ui_locales,h=e.id_token_hint,f=e.login_hint,_=e.acr_values,v=e.resource,m=e.response_mode,y=e.request,b=e.request_uri,S=e.extraQueryParams,k=e.request_type,w=e.client_secret,T=e.extraTokenParams,I=e.skipUserInfo;if(!t)throw a.error("SigninRequest.ctor: No url passed"),new Error("url");if(!n)throw a.error("SigninRequest.ctor: No client_id passed"),new Error("client_id");if(!i)throw a.error("SigninRequest.ctor: No redirect_uri passed"),new Error("redirect_uri");if(!o)throw a.error("SigninRequest.ctor: No response_type passed"),new Error("response_type");if(!s)throw a.error("SigninRequest.ctor: No scope passed"),new Error("scope");if(!u)throw a.error("SigninRequest.ctor: No authority passed"),new Error("authority");var P=SigninRequest.isOidc(o),R=SigninRequest.isCode(o);m||(m=SigninRequest.isCode(o)?"query":null),this.state=new q({nonce:P,data:c,client_id:n,authority:u,redirect_uri:i,code_verifier:R,request_type:k,response_mode:m,client_secret:w,scope:s,extraTokenParams:T,skipUserInfo:I}),t=O.addQueryParam(t,"client_id",n),t=O.addQueryParam(t,"redirect_uri",i),t=O.addQueryParam(t,"response_type",o),t=O.addQueryParam(t,"scope",s),t=O.addQueryParam(t,"state",this.state.id),P&&(t=O.addQueryParam(t,"nonce",this.state.nonce)),R&&(t=O.addQueryParam(t,"code_challenge",this.state.code_challenge),t=O.addQueryParam(t,"code_challenge_method","S256"));var C={prompt:d,display:p,max_age:l,ui_locales:g,id_token_hint:h,login_hint:f,acr_values:_,resource:v,request:y,request_uri:b,response_mode:m};for(var U in C)C[U]&&(t=O.addQueryParam(t,U,C[U]));for(var E in S)t=O.addQueryParam(t,E,S[E]);this.url=t}return SigninRequest.isOidc=function isOidc(e){return!!e.split(/\s+/g).filter((function(e){return"id_token"===e}))[0]},SigninRequest.isOAuth=function isOAuth(e){return!!e.split(/\s+/g).filter((function(e){return"token"===e}))[0]},SigninRequest.isCode=function isCode(e){return!!e.split(/\s+/g).filter((function(e){return"code"===e}))[0]},SigninRequest}();function SigninResponse_defineProperties(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var W=function(){function SigninResponse(e,t){void 0===t&&(t="#");var n=O.parseUrlFragment(e,t);this.error=n.error,this.error_description=n.error_description,this.error_uri=n.error_uri,this.code=n.code,this.state=n.state,this.id_token=n.id_token,this.session_state=n.session_state,this.access_token=n.access_token,this.token_type=n.token_type,this.scope=n.scope,this.profile=void 0,this.expires_in=n.expires_in}return function SigninResponse_createClass(e,t,n){return t&&SigninResponse_defineProperties(e.prototype,t),n&&SigninResponse_defineProperties(e,n),e}(SigninResponse,[{key:"expires_in",get:function get(){if(this.expires_at){var e=parseInt(Date.now()/1e3);return this.expires_at-e}},set:function set(e){var t=parseInt(e);if("number"==typeof t&&t>0){var n=parseInt(Date.now()/1e3);this.expires_at=n+t}}},{key:"expired",get:function get(){var e=this.expires_in;if(void 0!==e)return e<=0}},{key:"scopes",get:function get(){return(this.scope||"").split(" ")}},{key:"isOpenIdConnect",get:function get(){return this.scopes.indexOf("openid")>=0||!!this.id_token}}]),SigninResponse}(),D=function SignoutRequest(e){var t=e.url,n=e.id_token_hint,i=e.post_logout_redirect_uri,o=e.data,s=e.extraQueryParams,u=e.request_type;if(!t)throw a.error("SignoutRequest.ctor: No url passed"),new Error("url");for(var c in n&&(t=O.addQueryParam(t,"id_token_hint",n)),i&&(t=O.addQueryParam(t,"post_logout_redirect_uri",i),o&&(this.state=new j({data:o,request_type:u}),t=O.addQueryParam(t,"state",this.state.id))),s)t=O.addQueryParam(t,c,s[c]);this.url=t},V=function SignoutResponse(e){var t=O.parseUrlFragment(e,"?");this.error=t.error,this.error_description=t.error_description,this.error_uri=t.error_uri,this.state=t.state};function OidcClient_defineProperties(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var L=function(){function OidcClient(e){void 0===e&&(e={}),this._settings=e instanceof B?e:new B(e)}var e=OidcClient.prototype;return e.createSigninRequest=function createSigninRequest(e,t){var n=this,i=void 0===e?{}:e,o=i.response_type,s=i.scope,u=i.redirect_uri,c=i.data,d=i.state,p=i.prompt,l=i.display,g=i.max_age,h=i.ui_locales,f=i.id_token_hint,_=i.login_hint,v=i.acr_values,m=i.resource,y=i.request,b=i.request_uri,S=i.response_mode,k=i.extraQueryParams,w=i.extraTokenParams,T=i.request_type,I=i.skipUserInfo;a.debug("OidcClient.createSigninRequest");var P=this._settings.client_id;o=o||this._settings.response_type,s=s||this._settings.scope,u=u||this._settings.redirect_uri,p=p||this._settings.prompt,l=l||this._settings.display,g=g||this._settings.max_age,h=h||this._settings.ui_locales,v=v||this._settings.acr_values,m=m||this._settings.resource,S=S||this._settings.response_mode,k=k||this._settings.extraQueryParams,w=w||this._settings.extraTokenParams;var R=this._settings.authority;return J.isCode(o)&&"code"!==o?Promise.reject(new Error("OpenID Connect hybrid flow is not supported")):this._metadataService.getAuthorizationEndpoint().then((function(e){a.debug("OidcClient.createSigninRequest: Received authorization endpoint",e);var i=new J({url:e,client_id:P,redirect_uri:u,response_type:o,scope:s,data:c||d,authority:R,prompt:p,display:l,max_age:g,ui_locales:h,id_token_hint:f,login_hint:_,acr_values:v,resource:m,request:y,request_uri:b,extraQueryParams:k,extraTokenParams:w,request_type:T,response_mode:S,client_secret:n._settings.client_secret,skipUserInfo:I}),C=i.state;return(t=t||n._stateStore).set(C.id,C.toStorageString()).then((function(){return i}))}))},e.readSigninResponseState=function readSigninResponseState(e,t,n){void 0===n&&(n=!1),a.debug("OidcClient.readSigninResponseState");var i="query"===this._settings.response_mode||!this._settings.response_mode&&J.isCode(this._settings.response_type),o=new W(e,i?"?":"#");return o.state?(t=t||this._stateStore,(n?t.remove.bind(t):t.get.bind(t))(o.state).then((function(e){if(!e)throw a.error("OidcClient.readSigninResponseState: No matching state found in storage"),new Error("No matching state found in storage");return{state:q.fromStorageString(e),response:o}}))):(a.error("OidcClient.readSigninResponseState: No state in response"),Promise.reject(new Error("No state in response")))},e.processSigninResponse=function processSigninResponse(e,t){var n=this;return a.debug("OidcClient.processSigninResponse"),this.readSigninResponseState(e,t,!0).then((function(e){var t=e.state,i=e.response;return a.debug("OidcClient.processSigninResponse: Received state from storage; validating response"),n._validator.validateSigninResponse(t,i)}))},e.createSignoutRequest=function createSignoutRequest(e,t){var n=this,i=void 0===e?{}:e,o=i.id_token_hint,s=i.data,u=i.state,c=i.post_logout_redirect_uri,d=i.extraQueryParams,p=i.request_type;return a.debug("OidcClient.createSignoutRequest"),c=c||this._settings.post_logout_redirect_uri,d=d||this._settings.extraQueryParams,this._metadataService.getEndSessionEndpoint().then((function(e){if(!e)throw a.error("OidcClient.createSignoutRequest: No end session endpoint url returned"),new Error("no end session endpoint");a.debug("OidcClient.createSignoutRequest: Received end session endpoint",e);var i=new D({url:e,id_token_hint:o,post_logout_redirect_uri:c,data:s||u,extraQueryParams:d,request_type:p}),l=i.state;return l&&(a.debug("OidcClient.createSignoutRequest: Signout request has state to persist"),(t=t||n._stateStore).set(l.id,l.toStorageString())),i}))},e.readSignoutResponseState=function readSignoutResponseState(e,t,n){void 0===n&&(n=!1),a.debug("OidcClient.readSignoutResponseState");var i=new V(e);if(!i.state)return a.debug("OidcClient.readSignoutResponseState: No state in response"),i.error?(a.warn("OidcClient.readSignoutResponseState: Response was error: ",i.error),Promise.reject(new E(i))):Promise.resolve({undefined:void 0,response:i});var o=i.state;return t=t||this._stateStore,(n?t.remove.bind(t):t.get.bind(t))(o).then((function(e){if(!e)throw a.error("OidcClient.readSignoutResponseState: No matching state found in storage"),new Error("No matching state found in storage");return{state:j.fromStorageString(e),response:i}}))},e.processSignoutResponse=function processSignoutResponse(e,t){var n=this;return a.debug("OidcClient.processSignoutResponse"),this.readSignoutResponseState(e,t,!0).then((function(e){var t=e.state,i=e.response;return t?(a.debug("OidcClient.processSignoutResponse: Received state from storage; validating response"),n._validator.validateSignoutResponse(t,i)):(a.debug("OidcClient.processSignoutResponse: No state from storage; skipping validating response"),i)}))},e.clearStaleState=function clearStaleState(e){return a.debug("OidcClient.clearStaleState"),e=e||this._stateStore,j.clearStaleState(e,this.settings.staleStateAge)},function OidcClient_createClass(e,t,n){return t&&OidcClient_defineProperties(e.prototype,t),n&&OidcClient_defineProperties(e,n),e}(OidcClient,[{key:"_stateStore",get:function get(){return this.settings.stateStore}},{key:"_validator",get:function get(){return this.settings.validator}},{key:"_metadataService",get:function get(){return this.settings.metadataService}},{key:"settings",get:function get(){return this._settings}},{key:"metadataService",get:function get(){return this._metadataService}}]),OidcClient}();function InMemoryWebStorage_defineProperties(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var H=function(){function InMemoryWebStorage(){this._data={}}var e=InMemoryWebStorage.prototype;return e.getItem=function getItem(e){return a.debug("InMemoryWebStorage.getItem",e),this._data[e]},e.setItem=function setItem(e,t){a.debug("InMemoryWebStorage.setItem",e),this._data[e]=t},e.removeItem=function removeItem(e){a.debug("InMemoryWebStorage.removeItem",e),delete this._data[e]},e.key=function key(e){return Object.getOwnPropertyNames(this._data)[e]},function InMemoryWebStorage_createClass(e,t,n){return t&&InMemoryWebStorage_defineProperties(e.prototype,t),n&&InMemoryWebStorage_defineProperties(e,n),e}(InMemoryWebStorage,[{key:"length",get:function get(){return Object.getOwnPropertyNames(this._data).length}}]),InMemoryWebStorage}();function RedirectNavigator_defineProperties(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var z=function(){function RedirectNavigator(){}var e=RedirectNavigator.prototype;return e.prepare=function prepare(){return Promise.resolve(this)},e.navigate=function navigate(e){return e&&e.url?(e.useReplaceToNavigate?window.location.replace(e.url):window.location=e.url,Promise.resolve()):(a.error("RedirectNavigator.navigate: No url provided"),Promise.reject(new Error("No url provided")))},function RedirectNavigator_createClass(e,t,n){return t&&RedirectNavigator_defineProperties(e.prototype,t),n&&RedirectNavigator_defineProperties(e,n),e}(RedirectNavigator,[{key:"url",get:function get(){return window.location.href}}]),RedirectNavigator}();function PopupWindow_defineProperties(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var K=function(){function PopupWindow(e){var t=this;this._promise=new Promise((function(e,n){t._resolve=e,t._reject=n}));var n=e.popupWindowTarget||"_blank",i=e.popupWindowFeatures||"location=no,toolbar=no,width=500,height=500,left=100,top=100;";this._popup=window.open("",n,i),this._popup&&(a.debug("PopupWindow.ctor: popup successfully created"),this._checkForPopupClosedTimer=window.setInterval(this._checkForPopupClosed.bind(this),500))}var e=PopupWindow.prototype;return e.navigate=function navigate(e){return this._popup?e&&e.url?(a.debug("PopupWindow.navigate: Setting URL in popup"),this._id=e.id,this._id&&(window["popupCallback_"+e.id]=this._callback.bind(this)),this._popup.focus(),this._popup.window.location=e.url):(this._error("PopupWindow.navigate: no url provided"),this._error("No url provided")):this._error("PopupWindow.navigate: Error opening popup window"),this.promise},e._success=function _success(e){a.debug("PopupWindow.callback: Successful response from popup window"),this._cleanup(),this._resolve(e)},e._error=function _error(e){a.error("PopupWindow.error: ",e),this._cleanup(),this._reject(new Error(e))},e.close=function close(){this._cleanup(!1)},e._cleanup=function _cleanup(e){a.debug("PopupWindow.cleanup"),window.clearInterval(this._checkForPopupClosedTimer),this._checkForPopupClosedTimer=null,delete window["popupCallback_"+this._id],this._popup&&!e&&this._popup.close(),this._popup=null},e._checkForPopupClosed=function _checkForPopupClosed(){this._popup&&!this._popup.closed||this._error("Popup window closed")},e._callback=function _callback(e,t){this._cleanup(t),e?(a.debug("PopupWindow.callback success"),this._success({url:e})):(a.debug("PopupWindow.callback: Invalid response from popup"),this._error("Invalid response from popup"))},PopupWindow.notifyOpener=function notifyOpener(e,t,n){if(window.opener){if(e=e||window.location.href){var i=O.parseUrlFragment(e,n);if(i.state){var o="popupCallback_"+i.state,s=window.opener[o];s?(a.debug("PopupWindow.notifyOpener: passing url message to opener"),s(e,t)):a.warn("PopupWindow.notifyOpener: no matching callback found on opener")}else a.warn("PopupWindow.notifyOpener: no state found in response url")}}else a.warn("PopupWindow.notifyOpener: no window.opener. Can't complete notification.")},function PopupWindow_createClass(e,t,n){return t&&PopupWindow_defineProperties(e.prototype,t),n&&PopupWindow_defineProperties(e,n),e}(PopupWindow,[{key:"promise",get:function get(){return this._promise}}]),PopupWindow}(),Q=function(){function PopupNavigator(){}var e=PopupNavigator.prototype;return e.prepare=function prepare(e){var t=new K(e);return Promise.resolve(t)},e.callback=function callback(e,t,n){a.debug("PopupNavigator.callback");try{return K.notifyOpener(e,t,n),Promise.resolve()}catch(e){return Promise.reject(e)}},PopupNavigator}();function IFrameWindow_defineProperties(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var X=function(){function IFrameWindow(e){var t=this;this._promise=new Promise((function(e,n){t._resolve=e,t._reject=n})),this._boundMessageEvent=this._message.bind(this),window.addEventListener("message",this._boundMessageEvent,!1),this._frame=window.document.createElement("iframe"),this._frame.style.visibility="hidden",this._frame.style.position="absolute",this._frame.style.display="none",this._frame.style.width=0,this._frame.style.height=0,window.document.body.appendChild(this._frame)}var e=IFrameWindow.prototype;return e.navigate=function navigate(e){if(e&&e.url){var t=e.silentRequestTimeout||1e4;a.debug("IFrameWindow.navigate: Using timeout of:",t),this._timer=window.setTimeout(this._timeout.bind(this),t),this._frame.src=e.url}else this._error("No url provided");return this.promise},e._success=function _success(e){this._cleanup(),a.debug("IFrameWindow: Successful response from frame window"),this._resolve(e)},e._error=function _error(e){this._cleanup(),a.error(e),this._reject(new Error(e))},e.close=function close(){this._cleanup()},e._cleanup=function _cleanup(){this._frame&&(a.debug("IFrameWindow: cleanup"),window.removeEventListener("message",this._boundMessageEvent,!1),window.clearTimeout(this._timer),window.document.body.removeChild(this._frame),this._timer=null,this._frame=null,this._boundMessageEvent=null)},e._timeout=function _timeout(){a.debug("IFrameWindow.timeout"),this._error("Frame window timed out")},e._message=function _message(e){if(a.debug("IFrameWindow.message"),this._timer&&e.origin===this._origin&&e.source===this._frame.contentWindow){var t=e.data;t?this._success({url:t}):this._error("Invalid response from frame")}},IFrameWindow.notifyParent=function notifyParent(e){a.debug("IFrameWindow.notifyParent"),window.frameElement&&(e=e||window.location.href)&&(a.debug("IFrameWindow.notifyParent: posting url message to parent"),window.parent.postMessage(e,location.protocol+"//"+location.host))},function IFrameWindow_createClass(e,t,n){return t&&IFrameWindow_defineProperties(e.prototype,t),n&&IFrameWindow_defineProperties(e,n),e}(IFrameWindow,[{key:"promise",get:function get(){return this._promise}},{key:"_origin",get:function get(){return location.protocol+"//"+location.host}}]),IFrameWindow}(),G=function(){function IFrameNavigator(){}var e=IFrameNavigator.prototype;return e.prepare=function prepare(e){var t=new X(e);return Promise.resolve(t)},e.callback=function callback(e){a.debug("IFrameNavigator.callback");try{return X.notifyParent(e),Promise.resolve()}catch(e){return Promise.reject(e)}},IFrameNavigator}();function UserManagerSettings_defineProperties(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var Z=function(e){function UserManagerSettings(t){var n,i=void 0===t?{}:t,o=i.popup_redirect_uri,s=i.popup_post_logout_redirect_uri,a=i.popupWindowFeatures,u=i.popupWindowTarget,c=i.silent_redirect_uri,d=i.silentRequestTimeout,g=i.automaticSilentRenew,h=void 0!==g&&g,f=i.validateSubOnSilentRenew,_=void 0!==f&&f,v=i.includeIdTokenInSilentRenew,m=void 0===v||v,y=i.monitorSession,b=void 0===y||y,S=i.monitorAnonymousSession,k=void 0!==S&&S,w=i.checkSessionInterval,T=void 0===w?2e3:w,I=i.stopCheckSessionOnError,P=void 0===I||I,R=i.query_status_response_type,C=i.revokeAccessTokenOnSignout,U=void 0!==C&&C,E=i.accessTokenExpiringNotificationTime,M=void 0===E?60:E,x=i.redirectNavigator,B=void 0===x?new z:x,O=i.popupNavigator,A=void 0===O?new Q:O,N=i.iframeNavigator,j=void 0===N?new G:N,q=i.userStore,W=void 0===q?new l({store:p.sessionStorage}):q;return(n=e.call(this,arguments[0])||this)._popup_redirect_uri=o,n._popup_post_logout_redirect_uri=s,n._popupWindowFeatures=a,n._popupWindowTarget=u,n._silent_redirect_uri=c,n._silentRequestTimeout=d,n._automaticSilentRenew=h,n._validateSubOnSilentRenew=_,n._includeIdTokenInSilentRenew=m,n._accessTokenExpiringNotificationTime=M,n._monitorSession=b,n._monitorAnonymousSession=k,n._checkSessionInterval=T,n._stopCheckSessionOnError=P,R?n._query_status_response_type=R:arguments[0]&&arguments[0].response_type?n._query_status_response_type=J.isOidc(arguments[0].response_type)?"id_token":"code":n._query_status_response_type="id_token",n._revokeAccessTokenOnSignout=U,n._redirectNavigator=B,n._popupNavigator=A,n._iframeNavigator=j,n._userStore=W,n}return function UserManagerSettings_inheritsLoose(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e,e.__proto__=t}(UserManagerSettings,e),function UserManagerSettings_createClass(e,t,n){return t&&UserManagerSettings_defineProperties(e.prototype,t),n&&UserManagerSettings_defineProperties(e,n),e}(UserManagerSettings,[{key:"popup_redirect_uri",get:function get(){return this._popup_redirect_uri}},{key:"popup_post_logout_redirect_uri",get:function get(){return this._popup_post_logout_redirect_uri}},{key:"popupWindowFeatures",get:function get(){return this._popupWindowFeatures}},{key:"popupWindowTarget",get:function get(){return this._popupWindowTarget}},{key:"silent_redirect_uri",get:function get(){return this._silent_redirect_uri}},{key:"silentRequestTimeout",get:function get(){return this._silentRequestTimeout}},{key:"automaticSilentRenew",get:function get(){return this._automaticSilentRenew}},{key:"validateSubOnSilentRenew",get:function get(){return this._validateSubOnSilentRenew}},{key:"includeIdTokenInSilentRenew",get:function get(){return this._includeIdTokenInSilentRenew}},{key:"accessTokenExpiringNotificationTime",get:function get(){return this._accessTokenExpiringNotificationTime}},{key:"monitorSession",get:function get(){return this._monitorSession}},{key:"monitorAnonymousSession",get:function get(){return this._monitorAnonymousSession}},{key:"checkSessionInterval",get:function get(){return this._checkSessionInterval}},{key:"stopCheckSessionOnError",get:function get(){return this._stopCheckSessionOnError}},{key:"query_status_response_type",get:function get(){return this._query_status_response_type}},{key:"revokeAccessTokenOnSignout",get:function get(){return this._revokeAccessTokenOnSignout}},{key:"redirectNavigator",get:function get(){return this._redirectNavigator}},{key:"popupNavigator",get:function get(){return this._popupNavigator}},{key:"iframeNavigator",get:function get(){return this._iframeNavigator}},{key:"userStore",get:function get(){return this._userStore}}]),UserManagerSettings}(B);function User_defineProperties(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var Y=function(){function User(e){var t=e.id_token,n=e.session_state,i=e.access_token,o=e.refresh_token,s=e.token_type,a=e.scope,u=e.profile,c=e.expires_at,d=e.state;this.id_token=t,this.session_state=n,this.access_token=i,this.refresh_token=o,this.token_type=s,this.scope=a,this.profile=u,this.expires_at=c,this.state=d}return User.prototype.toStorageString=function toStorageString(){return a.debug("User.toStorageString"),JSON.stringify({id_token:this.id_token,session_state:this.session_state,access_token:this.access_token,refresh_token:this.refresh_token,token_type:this.token_type,scope:this.scope,profile:this.profile,expires_at:this.expires_at})},User.fromStorageString=function fromStorageString(e){return a.debug("User.fromStorageString"),new User(JSON.parse(e))},function User_createClass(e,t,n){return t&&User_defineProperties(e.prototype,t),n&&User_defineProperties(e,n),e}(User,[{key:"expires_in",get:function get(){if(this.expires_at){var e=parseInt(Date.now()/1e3);return this.expires_at-e}},set:function set(e){var t=parseInt(e);if("number"==typeof t&&t>0){var n=parseInt(Date.now()/1e3);this.expires_at=n+t}}},{key:"expired",get:function get(){var e=this.expires_in;if(void 0!==e)return e<=0}},{key:"scopes",get:function get(){return(this.scope||"").split(" ")}}]),User}(),$=function(){function Event(e){this._name=e,this._callbacks=[]}var e=Event.prototype;return e.addHandler=function addHandler(e){this._callbacks.push(e)},e.removeHandler=function removeHandler(e){var t=this._callbacks.findIndex((function(t){return t===e}));t>=0&&this._callbacks.splice(t,1)},e.raise=function raise(){a.debug("Event: Raising event: "+this._name);for(var e=0;e<this._callbacks.length;e++){var t;(t=this._callbacks)[e].apply(t,arguments)}},Event}();function Timer_defineProperties(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var ee=function(e){function Timer(t,n,i){var o;return void 0===n&&(n=p.timer),void 0===i&&(i=void 0),(o=e.call(this,t)||this)._timer=n,o._nowFunc=i||function(){return Date.now()/1e3},o}!function Timer_inheritsLoose(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e,e.__proto__=t}(Timer,e);var t=Timer.prototype;return t.init=function init(e){e<=0&&(e=1),e=parseInt(e);var t=this.now+e;if(this.expiration===t&&this._timerHandle)a.debug("Timer.init timer "+this._name+" skipping initialization since already initialized for expiration:",this.expiration);else{this.cancel(),a.debug("Timer.init timer "+this._name+" for duration:",e),this._expiration=t;var n=5;e<n&&(n=e),this._timerHandle=this._timer.setInterval(this._callback.bind(this),1e3*n)}},t.cancel=function cancel(){this._timerHandle&&(a.debug("Timer.cancel: ",this._name),this._timer.clearInterval(this._timerHandle),this._timerHandle=null)},t._callback=function _callback(){var t=this._expiration-this.now;a.debug("Timer.callback; "+this._name+" timer expires in:",t),this._expiration<=this.now&&(this.cancel(),e.prototype.raise.call(this))},function Timer_createClass(e,t,n){return t&&Timer_defineProperties(e.prototype,t),n&&Timer_defineProperties(e,n),e}(Timer,[{key:"now",get:function get(){return parseInt(this._nowFunc())}},{key:"expiration",get:function get(){return this._expiration}}]),Timer}($),te=function(){function AccessTokenEvents(e){var t=void 0===e?{}:e,n=t.accessTokenExpiringNotificationTime,i=void 0===n?60:n,o=t.accessTokenExpiringTimer,s=void 0===o?new ee("Access token expiring"):o,a=t.accessTokenExpiredTimer,u=void 0===a?new ee("Access token expired"):a;this._accessTokenExpiringNotificationTime=i,this._accessTokenExpiring=s,this._accessTokenExpired=u}var e=AccessTokenEvents.prototype;return e.load=function load(e){if(e.access_token&&void 0!==e.expires_in){var t=e.expires_in;if(a.debug("AccessTokenEvents.load: access token present, remaining duration:",t),t>0){var n=t-this._accessTokenExpiringNotificationTime;n<=0&&(n=1),a.debug("AccessTokenEvents.load: registering expiring timer in:",n),this._accessTokenExpiring.init(n)}else a.debug("AccessTokenEvents.load: canceling existing expiring timer becase we're past expiration."),this._accessTokenExpiring.cancel();var i=t+1;a.debug("AccessTokenEvents.load: registering expired timer in:",i),this._accessTokenExpired.init(i)}else this._accessTokenExpiring.cancel(),this._accessTokenExpired.cancel()},e.unload=function unload(){a.debug("AccessTokenEvents.unload: canceling existing access token timers"),this._accessTokenExpiring.cancel(),this._accessTokenExpired.cancel()},e.addAccessTokenExpiring=function addAccessTokenExpiring(e){this._accessTokenExpiring.addHandler(e)},e.removeAccessTokenExpiring=function removeAccessTokenExpiring(e){this._accessTokenExpiring.removeHandler(e)},e.addAccessTokenExpired=function addAccessTokenExpired(e){this._accessTokenExpired.addHandler(e)},e.removeAccessTokenExpired=function removeAccessTokenExpired(e){this._accessTokenExpired.removeHandler(e)},AccessTokenEvents}();var re=function(e){function UserManagerEvents(t){var n;return(n=e.call(this,t)||this)._userLoaded=new $("User loaded"),n._userUnloaded=new $("User unloaded"),n._silentRenewError=new $("Silent renew error"),n._userSignedIn=new $("User signed in"),n._userSignedOut=new $("User signed out"),n._userSessionChanged=new $("User session changed"),n}!function UserManagerEvents_inheritsLoose(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e,e.__proto__=t}(UserManagerEvents,e);var t=UserManagerEvents.prototype;return t.load=function load(t,n){void 0===n&&(n=!0),a.debug("UserManagerEvents.load"),e.prototype.load.call(this,t),n&&this._userLoaded.raise(t)},t.unload=function unload(){a.debug("UserManagerEvents.unload"),e.prototype.unload.call(this),this._userUnloaded.raise()},t.addUserLoaded=function addUserLoaded(e){this._userLoaded.addHandler(e)},t.removeUserLoaded=function removeUserLoaded(e){this._userLoaded.removeHandler(e)},t.addUserUnloaded=function addUserUnloaded(e){this._userUnloaded.addHandler(e)},t.removeUserUnloaded=function removeUserUnloaded(e){this._userUnloaded.removeHandler(e)},t.addSilentRenewError=function addSilentRenewError(e){this._silentRenewError.addHandler(e)},t.removeSilentRenewError=function removeSilentRenewError(e){this._silentRenewError.removeHandler(e)},t._raiseSilentRenewError=function _raiseSilentRenewError(e){a.debug("UserManagerEvents._raiseSilentRenewError",e.message),this._silentRenewError.raise(e)},t.addUserSignedIn=function addUserSignedIn(e){this._userSignedIn.addHandler(e)},t.removeUserSignedIn=function removeUserSignedIn(e){this._userSignedIn.removeHandler(e)},t._raiseUserSignedIn=function _raiseUserSignedIn(){a.debug("UserManagerEvents._raiseUserSignedIn"),this._userSignedIn.raise()},t.addUserSignedOut=function addUserSignedOut(e){this._userSignedOut.addHandler(e)},t.removeUserSignedOut=function removeUserSignedOut(e){this._userSignedOut.removeHandler(e)},t._raiseUserSignedOut=function _raiseUserSignedOut(){a.debug("UserManagerEvents._raiseUserSignedOut"),this._userSignedOut.raise()},t.addUserSessionChanged=function addUserSessionChanged(e){this._userSessionChanged.addHandler(e)},t.removeUserSessionChanged=function removeUserSessionChanged(e){this._userSessionChanged.removeHandler(e)},t._raiseUserSessionChanged=function _raiseUserSessionChanged(){a.debug("UserManagerEvents._raiseUserSessionChanged"),this._userSessionChanged.raise()},UserManagerEvents}(te),ne=function(){function SilentRenewService(e){this._userManager=e}var e=SilentRenewService.prototype;return e.start=function start(){this._callback||(this._callback=this._tokenExpiring.bind(this),this._userManager.events.addAccessTokenExpiring(this._callback),this._userManager.getUser().then((function(e){})).catch((function(e){a.error("SilentRenewService.start: Error from getUser:",e.message)})))},e.stop=function stop(){this._callback&&(this._userManager.events.removeAccessTokenExpiring(this._callback),delete this._callback)},e._tokenExpiring=function _tokenExpiring(){var e=this;this._userManager.signinSilent().then((function(e){a.debug("SilentRenewService._tokenExpiring: Silent token renewal successful")}),(function(t){a.error("SilentRenewService._tokenExpiring: Error from signinSilent:",t.message),e._userManager.events._raiseSilentRenewError(t)}))},SilentRenewService}(),ie=function(){function CheckSessionIFrame(e,t,n,i,o){void 0===o&&(o=!0),this._callback=e,this._client_id=t,this._url=n,this._interval=i||2e3,this._stopOnError=o;var s=n.indexOf("/",n.indexOf("//")+2);this._frame_origin=n.substr(0,s),this._frame=window.document.createElement("iframe"),this._frame.style.visibility="hidden",this._frame.style.position="absolute",this._frame.style.display="none",this._frame.style.width=0,this._frame.style.height=0,this._frame.src=n}var e=CheckSessionIFrame.prototype;return e.load=function load(){var e=this;return new Promise((function(t){e._frame.onload=function(){t()},window.document.body.appendChild(e._frame),e._boundMessageEvent=e._message.bind(e),window.addEventListener("message",e._boundMessageEvent,!1)}))},e._message=function _message(e){e.origin===this._frame_origin&&e.source===this._frame.contentWindow&&("error"===e.data?(a.error("CheckSessionIFrame: error message from check session op iframe"),this._stopOnError&&this.stop()):"changed"===e.data?(a.debug("CheckSessionIFrame: changed message from check session op iframe"),this.stop(),this._callback()):a.debug("CheckSessionIFrame: "+e.data+" message from check session op iframe"))},e.start=function start(e){var t=this;if(this._session_state!==e){a.debug("CheckSessionIFrame.start"),this.stop(),this._session_state=e;var n=function send(){t._frame.contentWindow.postMessage(t._client_id+" "+t._session_state,t._frame_origin)};n(),this._timer=window.setInterval(n,this._interval)}},e.stop=function stop(){this._session_state=null,this._timer&&(a.debug("CheckSessionIFrame.stop"),window.clearInterval(this._timer),this._timer=null)},CheckSessionIFrame}();function SessionMonitor_defineProperties(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var oe=function(){function SessionMonitor(e,t,n){var i=this;if(void 0===t&&(t=ie),void 0===n&&(n=p.timer),!e)throw a.error("SessionMonitor.ctor: No user manager passed to SessionMonitor"),new Error("userManager");this._userManager=e,this._CheckSessionIFrameCtor=t,this._timer=n,this._userManager.events.addUserLoaded(this._start.bind(this)),this._userManager.events.addUserUnloaded(this._stop.bind(this)),this._userManager.getUser().then((function(e){e?i._start(e):i._settings.monitorAnonymousSession&&i._userManager.querySessionStatus().then((function(e){var t={session_state:e.session_state};e.sub&&e.sid&&(t.profile={sub:e.sub,sid:e.sid}),i._start(t)})).catch((function(e){a.error("SessionMonitor ctor: error from querySessionStatus:",e.message)}))})).catch((function(e){a.error("SessionMonitor ctor: error from getUser:",e.message)}))}var e=SessionMonitor.prototype;return e._start=function _start(e){var t=this,n=e.session_state;n&&(e.profile?(this._sub=e.profile.sub,this._sid=e.profile.sid,a.debug("SessionMonitor._start: session_state:",n,", sub:",this._sub)):(this._sub=void 0,this._sid=void 0,a.debug("SessionMonitor._start: session_state:",n,", anonymous user")),this._checkSessionIFrame?this._checkSessionIFrame.start(n):this._metadataService.getCheckSessionIframe().then((function(e){if(e){a.debug("SessionMonitor._start: Initializing check session iframe");var i=t._client_id,o=t._checkSessionInterval,s=t._stopCheckSessionOnError;t._checkSessionIFrame=new t._CheckSessionIFrameCtor(t._callback.bind(t),i,e,o,s),t._checkSessionIFrame.load().then((function(){t._checkSessionIFrame.start(n)}))}else a.warn("SessionMonitor._start: No check session iframe found in the metadata")})).catch((function(e){a.error("SessionMonitor._start: Error from getCheckSessionIframe:",e.message)})))},e._stop=function _stop(){var e=this;if(this._sub=void 0,this._sid=void 0,this._checkSessionIFrame&&(a.debug("SessionMonitor._stop"),this._checkSessionIFrame.stop()),this._settings.monitorAnonymousSession)var t=this._timer.setInterval((function(){e._timer.clearInterval(t),e._userManager.querySessionStatus().then((function(t){var n={session_state:t.session_state};t.sub&&t.sid&&(n.profile={sub:t.sub,sid:t.sid}),e._start(n)})).catch((function(e){a.error("SessionMonitor: error from querySessionStatus:",e.message)}))}),1e3)},e._callback=function _callback(){var e=this;this._userManager.querySessionStatus().then((function(t){var n=!0;t?t.sub===e._sub?(n=!1,e._checkSessionIFrame.start(t.session_state),t.sid===e._sid?a.debug("SessionMonitor._callback: Same sub still logged in at OP, restarting check session iframe; session_state:",t.session_state):(a.debug("SessionMonitor._callback: Same sub still logged in at OP, session state has changed, restarting check session iframe; session_state:",t.session_state),e._userManager.events._raiseUserSessionChanged())):a.debug("SessionMonitor._callback: Different subject signed into OP:",t.sub):a.debug("SessionMonitor._callback: Subject no longer signed into OP"),n&&(e._sub?(a.debug("SessionMonitor._callback: SessionMonitor._callback; raising signed out event"),e._userManager.events._raiseUserSignedOut()):(a.debug("SessionMonitor._callback: SessionMonitor._callback; raising signed in event"),e._userManager.events._raiseUserSignedIn()))})).catch((function(t){e._sub&&(a.debug("SessionMonitor._callback: Error calling queryCurrentSigninSession; raising signed out event",t.message),e._userManager.events._raiseUserSignedOut())}))},function SessionMonitor_createClass(e,t,n){return t&&SessionMonitor_defineProperties(e.prototype,t),n&&SessionMonitor_defineProperties(e,n),e}(SessionMonitor,[{key:"_settings",get:function get(){return this._userManager.settings}},{key:"_metadataService",get:function get(){return this._userManager.metadataService}},{key:"_client_id",get:function get(){return this._settings.client_id}},{key:"_checkSessionInterval",get:function get(){return this._settings.checkSessionInterval}},{key:"_stopCheckSessionOnError",get:function get(){return this._settings.stopCheckSessionOnError}}]),SessionMonitor}(),se=function(){function TokenRevocationClient(e,t,n){if(void 0===t&&(t=p.XMLHttpRequest),void 0===n&&(n=h),!e)throw a.error("TokenRevocationClient.ctor: No settings provided"),new Error("No settings provided.");this._settings=e,this._XMLHttpRequestCtor=t,this._metadataService=new n(this._settings)}var e=TokenRevocationClient.prototype;return e.revoke=function revoke(e,t,n){var i=this;if(void 0===n&&(n="access_token"),!e)throw a.error("TokenRevocationClient.revoke: No token provided"),new Error("No token provided.");if("access_token"!==n&&"refresh_token"!=n)throw a.error("TokenRevocationClient.revoke: Invalid token type"),new Error("Invalid token type.");return this._metadataService.getRevocationEndpoint().then((function(o){if(o){a.debug("TokenRevocationClient.revoke: Revoking "+n);var s=i._settings.client_id,u=i._settings.client_secret;return i._revoke(o,s,u,e,n)}if(t)throw a.error("TokenRevocationClient.revoke: Revocation not supported"),new Error("Revocation not supported")}))},e._revoke=function _revoke(e,t,n,i,o){var s=this;return new Promise((function(u,c){var d=new s._XMLHttpRequestCtor;d.open("POST",e),d.onload=function(){a.debug("TokenRevocationClient.revoke: HTTP response received, status",d.status),200===d.status?u():c(Error(d.statusText+" ("+d.status+")"))},d.onerror=function(){a.debug("TokenRevocationClient.revoke: Network Error."),c("Network Error")};var p="client_id="+encodeURIComponent(t);n&&(p+="&client_secret="+encodeURIComponent(n)),p+="&token_type_hint="+encodeURIComponent(o),p+="&token="+encodeURIComponent(i),d.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),d.send(p)}))},TokenRevocationClient}();function UserManager_defineProperties(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function _assertThisInitialized(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}var ae=function(e){function UserManager(t,n,i,o,s,u){var c;return void 0===t&&(t={}),void 0===n&&(n=ne),void 0===i&&(i=oe),void 0===o&&(o=se),void 0===s&&(s=U),void 0===u&&(u=R),t instanceof Z||(t=new Z(t)),(c=e.call(this,t)||this)._events=new re(t),c._silentRenewService=new n(_assertThisInitialized(c)),c.settings.automaticSilentRenew&&(a.debug("UserManager.ctor: automaticSilentRenew is configured, setting up silent renew"),c.startSilentRenew()),c.settings.monitorSession&&(a.debug("UserManager.ctor: monitorSession is configured, setting up session monitor"),c._sessionMonitor=new i(_assertThisInitialized(c))),c._tokenRevocationClient=new o(c._settings),c._tokenClient=new s(c._settings),c._joseUtil=u,c}!function UserManager_inheritsLoose(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e,e.__proto__=t}(UserManager,e);var t=UserManager.prototype;return t.getUser=function getUser(){var e=this;return this._loadUser().then((function(t){return t?(a.info("UserManager.getUser: user loaded"),e._events.load(t,!1),t):(a.info("UserManager.getUser: user not found in storage"),null)}))},t.removeUser=function removeUser(){var e=this;return this.storeUser(null).then((function(){a.info("UserManager.removeUser: user removed from storage"),e._events.unload()}))},t.signinRedirect=function signinRedirect(e){void 0===e&&(e={}),(e=Object.assign({},e)).request_type="si:r";var t={useReplaceToNavigate:e.useReplaceToNavigate};return this._signinStart(e,this._redirectNavigator,t).then((function(){a.info("UserManager.signinRedirect: successful")}))},t.signinRedirectCallback=function signinRedirectCallback(e){return this._signinEnd(e||this._redirectNavigator.url).then((function(e){return e.profile&&e.profile.sub?a.info("UserManager.signinRedirectCallback: successful, signed in sub: ",e.profile.sub):a.info("UserManager.signinRedirectCallback: no sub"),e}))},t.signinPopup=function signinPopup(e){void 0===e&&(e={}),(e=Object.assign({},e)).request_type="si:p";var t=e.redirect_uri||this.settings.popup_redirect_uri||this.settings.redirect_uri;return t?(e.redirect_uri=t,e.display="popup",this._signin(e,this._popupNavigator,{startUrl:t,popupWindowFeatures:e.popupWindowFeatures||this.settings.popupWindowFeatures,popupWindowTarget:e.popupWindowTarget||this.settings.popupWindowTarget}).then((function(e){return e&&(e.profile&&e.profile.sub?a.info("UserManager.signinPopup: signinPopup successful, signed in sub: ",e.profile.sub):a.info("UserManager.signinPopup: no sub")),e}))):(a.error("UserManager.signinPopup: No popup_redirect_uri or redirect_uri configured"),Promise.reject(new Error("No popup_redirect_uri or redirect_uri configured")))},t.signinPopupCallback=function signinPopupCallback(e){return this._signinCallback(e,this._popupNavigator).then((function(e){return e&&(e.profile&&e.profile.sub?a.info("UserManager.signinPopupCallback: successful, signed in sub: ",e.profile.sub):a.info("UserManager.signinPopupCallback: no sub")),e})).catch((function(e){a.error(e.message)}))},t.signinSilent=function signinSilent(e){var t=this;return void 0===e&&(e={}),(e=Object.assign({},e)).request_type="si:s",this._loadUser().then((function(n){return n&&n.refresh_token?(e.refresh_token=n.refresh_token,t._useRefreshToken(e)):(e.id_token_hint=e.id_token_hint||t.settings.includeIdTokenInSilentRenew&&n&&n.id_token,n&&t._settings.validateSubOnSilentRenew&&(a.debug("UserManager.signinSilent, subject prior to silent renew: ",n.profile.sub),e.current_sub=n.profile.sub),t._signinSilentIframe(e))}))},t._useRefreshToken=function _useRefreshToken(e){var t=this;return void 0===e&&(e={}),this._tokenClient.exchangeRefreshToken(e).then((function(e){return e?e.access_token?t._loadUser().then((function(n){if(n){var i=Promise.resolve();return e.id_token&&(i=t._validateIdTokenFromTokenRefreshToken(n.profile,e.id_token)),i.then((function(){return a.debug("UserManager._useRefreshToken: refresh token response success"),n.id_token=e.id_token,n.access_token=e.access_token,n.refresh_token=e.refresh_token||n.refresh_token,n.expires_in=e.expires_in,t.storeUser(n).then((function(){return t._events.load(n),n}))}))}return null})):(a.error("UserManager._useRefreshToken: No access token returned from token endpoint"),Promise.reject("No access token returned from token endpoint")):(a.error("UserManager._useRefreshToken: No response returned from token endpoint"),Promise.reject("No response returned from token endpoint"))}))},t._validateIdTokenFromTokenRefreshToken=function _validateIdTokenFromTokenRefreshToken(e,t){var n=this;return this._metadataService.getIssuer().then((function(i){return n._joseUtil.validateJwtAttributes(t,i,n._settings.client_id,n._settings.clockSkew).then((function(t){return t?t.sub!==e.sub?(a.error("UserManager._validateIdTokenFromTokenRefreshToken: sub in id_token does not match current sub"),Promise.reject(new Error("sub in id_token does not match current sub"))):t.auth_time&&t.auth_time!==e.auth_time?(a.error("UserManager._validateIdTokenFromTokenRefreshToken: auth_time in id_token does not match original auth_time"),Promise.reject(new Error("auth_time in id_token does not match original auth_time"))):t.azp&&t.azp!==e.azp?(a.error("UserManager._validateIdTokenFromTokenRefreshToken: azp in id_token does not match original azp"),Promise.reject(new Error("azp in id_token does not match original azp"))):!t.azp&&e.azp?(a.error("UserManager._validateIdTokenFromTokenRefreshToken: azp not in id_token, but present in original id_token"),Promise.reject(new Error("azp not in id_token, but present in original id_token"))):void 0:(a.error("UserManager._validateIdTokenFromTokenRefreshToken: Failed to validate id_token"),Promise.reject(new Error("Failed to validate id_token")))}))}))},t._signinSilentIframe=function _signinSilentIframe(e){void 0===e&&(e={});var t=e.redirect_uri||this.settings.silent_redirect_uri||this.settings.redirect_uri;return t?(e.redirect_uri=t,e.prompt=e.prompt||"none",this._signin(e,this._iframeNavigator,{startUrl:t,silentRequestTimeout:e.silentRequestTimeout||this.settings.silentRequestTimeout}).then((function(e){return e&&(e.profile&&e.profile.sub?a.info("UserManager.signinSilent: successful, signed in sub: ",e.profile.sub):a.info("UserManager.signinSilent: no sub")),e}))):(a.error("UserManager.signinSilent: No silent_redirect_uri configured"),Promise.reject(new Error("No silent_redirect_uri configured")))},t.signinSilentCallback=function signinSilentCallback(e){return this._signinCallback(e,this._iframeNavigator).then((function(e){return e&&(e.profile&&e.profile.sub?a.info("UserManager.signinSilentCallback: successful, signed in sub: ",e.profile.sub):a.info("UserManager.signinSilentCallback: no sub")),e}))},t.signinCallback=function signinCallback(e){var t=this;return this.readSigninResponseState(e).then((function(n){var i=n.state;n.response;return"si:r"===i.request_type?t.signinRedirectCallback(e):"si:p"===i.request_type?t.signinPopupCallback(e):"si:s"===i.request_type?t.signinSilentCallback(e):Promise.reject(new Error("invalid response_type in state"))}))},t.signoutCallback=function signoutCallback(e,t){var n=this;return this.readSignoutResponseState(e).then((function(i){var o=i.state,s=i.response;return o?"so:r"===o.request_type?n.signoutRedirectCallback(e):"so:p"===o.request_type?n.signoutPopupCallback(e,t):Promise.reject(new Error("invalid response_type in state")):s}))},t.querySessionStatus=function querySessionStatus(e){var t=this;void 0===e&&(e={}),(e=Object.assign({},e)).request_type="si:s";var n=e.redirect_uri||this.settings.silent_redirect_uri||this.settings.redirect_uri;return n?(e.redirect_uri=n,e.prompt="none",e.response_type=e.response_type||this.settings.query_status_response_type,e.scope=e.scope||"openid",e.skipUserInfo=!0,this._signinStart(e,this._iframeNavigator,{startUrl:n,silentRequestTimeout:e.silentRequestTimeout||this.settings.silentRequestTimeout}).then((function(e){return t.processSigninResponse(e.url).then((function(e){if(a.debug("UserManager.querySessionStatus: got signin response"),e.session_state&&e.profile.sub)return a.info("UserManager.querySessionStatus: querySessionStatus success for sub: ",e.profile.sub),{session_state:e.session_state,sub:e.profile.sub,sid:e.profile.sid};a.info("querySessionStatus successful, user not authenticated")})).catch((function(e){if(e.session_state&&t.settings.monitorAnonymousSession&&("login_required"==e.message||"consent_required"==e.message||"interaction_required"==e.message||"account_selection_required"==e.message))return a.info("UserManager.querySessionStatus: querySessionStatus success for anonymous user"),{session_state:e.session_state};throw e}))}))):(a.error("UserManager.querySessionStatus: No silent_redirect_uri configured"),Promise.reject(new Error("No silent_redirect_uri configured")))},t._signin=function _signin(e,t,n){var i=this;return void 0===n&&(n={}),this._signinStart(e,t,n).then((function(t){return i._signinEnd(t.url,e)}))},t._signinStart=function _signinStart(e,t,n){var i=this;return void 0===n&&(n={}),t.prepare(n).then((function(t){return a.debug("UserManager._signinStart: got navigator window handle"),i.createSigninRequest(e).then((function(e){return a.debug("UserManager._signinStart: got signin request"),n.url=e.url,n.id=e.state.id,t.navigate(n)})).catch((function(e){throw t.close&&(a.debug("UserManager._signinStart: Error after preparing navigator, closing navigator window"),t.close()),e}))}))},t._signinEnd=function _signinEnd(e,t){var n=this;return void 0===t&&(t={}),this.processSigninResponse(e).then((function(e){a.debug("UserManager._signinEnd: got signin response");var i=new Y(e);if(t.current_sub){if(t.current_sub!==i.profile.sub)return a.debug("UserManager._signinEnd: current user does not match user returned from signin. sub from signin: ",i.profile.sub),Promise.reject(new Error("login_required"));a.debug("UserManager._signinEnd: current user matches user returned from signin")}return n.storeUser(i).then((function(){return a.debug("UserManager._signinEnd: user stored"),n._events.load(i),i}))}))},t._signinCallback=function _signinCallback(e,t){return a.debug("UserManager._signinCallback"),t.callback(e)},t.signoutRedirect=function signoutRedirect(e){void 0===e&&(e={}),(e=Object.assign({},e)).request_type="so:r";var t=e.post_logout_redirect_uri||this.settings.post_logout_redirect_uri;t&&(e.post_logout_redirect_uri=t);var n={useReplaceToNavigate:e.useReplaceToNavigate};return this._signoutStart(e,this._redirectNavigator,n).then((function(){a.info("UserManager.signoutRedirect: successful")}))},t.signoutRedirectCallback=function signoutRedirectCallback(e){return this._signoutEnd(e||this._redirectNavigator.url).then((function(e){return a.info("UserManager.signoutRedirectCallback: successful"),e}))},t.signoutPopup=function signoutPopup(e){void 0===e&&(e={}),(e=Object.assign({},e)).request_type="so:p";var t=e.post_logout_redirect_uri||this.settings.popup_post_logout_redirect_uri||this.settings.post_logout_redirect_uri;return e.post_logout_redirect_uri=t,e.display="popup",e.post_logout_redirect_uri&&(e.state=e.state||{}),this._signout(e,this._popupNavigator,{startUrl:t,popupWindowFeatures:e.popupWindowFeatures||this.settings.popupWindowFeatures,popupWindowTarget:e.popupWindowTarget||this.settings.popupWindowTarget}).then((function(){a.info("UserManager.signoutPopup: successful")}))},t.signoutPopupCallback=function signoutPopupCallback(e,t){void 0===t&&"boolean"==typeof e&&(t=e,e=null);return this._popupNavigator.callback(e,t,"?").then((function(){a.info("UserManager.signoutPopupCallback: successful")}))},t._signout=function _signout(e,t,n){var i=this;return void 0===n&&(n={}),this._signoutStart(e,t,n).then((function(e){return i._signoutEnd(e.url)}))},t._signoutStart=function _signoutStart(e,t,n){var i=this;return void 0===e&&(e={}),void 0===n&&(n={}),t.prepare(n).then((function(t){return a.debug("UserManager._signoutStart: got navigator window handle"),i._loadUser().then((function(o){return a.debug("UserManager._signoutStart: loaded current user from storage"),(i._settings.revokeAccessTokenOnSignout?i._revokeInternal(o):Promise.resolve()).then((function(){var s=e.id_token_hint||o&&o.id_token;return s&&(a.debug("UserManager._signoutStart: Setting id_token into signout request"),e.id_token_hint=s),i.removeUser().then((function(){return a.debug("UserManager._signoutStart: user removed, creating signout request"),i.createSignoutRequest(e).then((function(e){return a.debug("UserManager._signoutStart: got signout request"),n.url=e.url,e.state&&(n.id=e.state.id),t.navigate(n)}))}))}))})).catch((function(e){throw t.close&&(a.debug("UserManager._signoutStart: Error after preparing navigator, closing navigator window"),t.close()),e}))}))},t._signoutEnd=function _signoutEnd(e){return this.processSignoutResponse(e).then((function(e){return a.debug("UserManager._signoutEnd: got signout response"),e}))},t.revokeAccessToken=function revokeAccessToken(){var e=this;return this._loadUser().then((function(t){return e._revokeInternal(t,!0).then((function(n){if(n)return a.debug("UserManager.revokeAccessToken: removing token properties from user and re-storing"),t.access_token=null,t.refresh_token=null,t.expires_at=null,t.token_type=null,e.storeUser(t).then((function(){a.debug("UserManager.revokeAccessToken: user stored"),e._events.load(t)}))}))})).then((function(){a.info("UserManager.revokeAccessToken: access token revoked successfully")}))},t._revokeInternal=function _revokeInternal(e,t){var n=this;if(e){var i=e.access_token,o=e.refresh_token;return this._revokeAccessTokenInternal(i,t).then((function(e){return n._revokeRefreshTokenInternal(o,t).then((function(t){return e||t||a.debug("UserManager.revokeAccessToken: no need to revoke due to no token(s), or JWT format"),e||t}))}))}return Promise.resolve(!1)},t._revokeAccessTokenInternal=function _revokeAccessTokenInternal(e,t){return!e||e.indexOf(".")>=0?Promise.resolve(!1):this._tokenRevocationClient.revoke(e,t).then((function(){return!0}))},t._revokeRefreshTokenInternal=function _revokeRefreshTokenInternal(e,t){return e?this._tokenRevocationClient.revoke(e,t,"refresh_token").then((function(){return!0})):Promise.resolve(!1)},t.startSilentRenew=function startSilentRenew(){this._silentRenewService.start()},t.stopSilentRenew=function stopSilentRenew(){this._silentRenewService.stop()},t._loadUser=function _loadUser(){return this._userStore.get(this._userStoreKey).then((function(e){return e?(a.debug("UserManager._loadUser: user storageString loaded"),Y.fromStorageString(e)):(a.debug("UserManager._loadUser: no user storageString"),null)}))},t.storeUser=function storeUser(e){if(e){a.debug("UserManager.storeUser: storing user");var t=e.toStorageString();return this._userStore.set(this._userStoreKey,t)}return a.debug("storeUser.storeUser: removing user"),this._userStore.remove(this._userStoreKey)},function UserManager_createClass(e,t,n){return t&&UserManager_defineProperties(e.prototype,t),n&&UserManager_defineProperties(e,n),e}(UserManager,[{key:"_redirectNavigator",get:function get(){return this.settings.redirectNavigator}},{key:"_popupNavigator",get:function get(){return this.settings.popupNavigator}},{key:"_iframeNavigator",get:function get(){return this.settings.iframeNavigator}},{key:"_userStore",get:function get(){return this.settings.userStore}},{key:"events",get:function get(){return this._events}},{key:"_userStoreKey",get:function get(){return"user:"+this.settings.authority+":"+this.settings.client_id}}]),UserManager}(L);function CordovaPopupWindow_defineProperties(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var ue=function(){function CordovaPopupWindow(e){var t=this;this._promise=new Promise((function(e,n){t._resolve=e,t._reject=n})),this.features=e.popupWindowFeatures||"location=no,toolbar=no,zoom=no",this.target=e.popupWindowTarget||"_blank",this.redirect_uri=e.startUrl,a.debug("CordovaPopupWindow.ctor: redirect_uri: "+this.redirect_uri)}var e=CordovaPopupWindow.prototype;return e._isInAppBrowserInstalled=function _isInAppBrowserInstalled(e){return["cordova-plugin-inappbrowser","cordova-plugin-inappbrowser.inappbrowser","org.apache.cordova.inappbrowser"].some((function(t){return e.hasOwnProperty(t)}))},e.navigate=function navigate(e){if(e&&e.url){if(!window.cordova)return this._error("cordova is undefined");var t=window.cordova.require("cordova/plugin_list").metadata;if(!1===this._isInAppBrowserInstalled(t))return this._error("InAppBrowser plugin not found");this._popup=cordova.InAppBrowser.open(e.url,this.target,this.features),this._popup?(a.debug("CordovaPopupWindow.navigate: popup successfully created"),this._exitCallbackEvent=this._exitCallback.bind(this),this._loadStartCallbackEvent=this._loadStartCallback.bind(this),this._popup.addEventListener("exit",this._exitCallbackEvent,!1),this._popup.addEventListener("loadstart",this._loadStartCallbackEvent,!1)):this._error("Error opening popup window")}else this._error("No url provided");return this.promise},e._loadStartCallback=function _loadStartCallback(e){0===e.url.indexOf(this.redirect_uri)&&this._success({url:e.url})},e._exitCallback=function _exitCallback(e){this._error(e)},e._success=function _success(e){this._cleanup(),a.debug("CordovaPopupWindow: Successful response from cordova popup window"),this._resolve(e)},e._error=function _error(e){this._cleanup(),a.error(e),this._reject(new Error(e))},e.close=function close(){this._cleanup()},e._cleanup=function _cleanup(){this._popup&&(a.debug("CordovaPopupWindow: cleaning up popup"),this._popup.removeEventListener("exit",this._exitCallbackEvent,!1),this._popup.removeEventListener("loadstart",this._loadStartCallbackEvent,!1),this._popup.close()),this._popup=null},function CordovaPopupWindow_createClass(e,t,n){return t&&CordovaPopupWindow_defineProperties(e.prototype,t),n&&CordovaPopupWindow_defineProperties(e,n),e}(CordovaPopupWindow,[{key:"promise",get:function get(){return this._promise}}]),CordovaPopupWindow}(),ce=function(){function CordovaPopupNavigator(){}return CordovaPopupNavigator.prototype.prepare=function prepare(e){var t=new ue(e);return Promise.resolve(t)},CordovaPopupNavigator}(),de=function(){function CordovaIFrameNavigator(){}return CordovaIFrameNavigator.prototype.prepare=function prepare(e){e.popupWindowFeatures="hidden=yes";var t=new ue(e);return Promise.resolve(t)},CordovaIFrameNavigator}();t.default={Version:"1.10.1",Log:a,OidcClient:L,OidcClientSettings:B,WebStorageStateStore:l,InMemoryWebStorage:H,UserManager:ae,AccessTokenEvents:te,MetadataService:h,CordovaPopupNavigator:ce,CordovaIFrameNavigator:de,CheckSessionIFrame:ie,TokenRevocationClient:se,SessionMonitor:oe,Global:p,User:Y}}])}));